<!DOCTYPE html>
<html lang="es" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resultados Electorales - Honduras 2025</title>

    <style>
        :root {
            --accent-color: #00bee5;
            --accent-hover: #00a5cc;
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --text-primary: #1a1a1a;
            --text-secondary: #6c757d;
            --border-color: #e0e0e0;
            --card-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            --card-hover-shadow: 0 4px 12px rgba(0, 190, 229, 0.2);
        }

        [data-theme="dark"] {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --text-primary: #f5f5f5;
            --text-secondary: #b0b0b0;
            --border-color: #404040;
            --card-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            --card-hover-shadow: 0 4px 12px rgba(0, 190, 229, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            height: auto;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        header {
            padding: 5px 0 5px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
            flex-wrap: wrap;
        }

        header > div {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        header img {
            max-width: 100px;
        }

        header h1 {
            margin-left: 2rem;
            color: var(--text-secondary)
        }

        /* Controls Section */
        .controls {
            padding: 15px 0;
            display: flex;
            gap: 15px;
            align-items: center;
            justify-content: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
            min-width: 250px;
        }

        .control-label {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        select {
            padding: 10px 15px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            max-width: 270px;
            min-width: 100%;
        }

        select:hover {
            border-color: var(--accent-color);
        }

        select:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(0, 190, 229, 0.1);
        }

        .info-bar {
            display: grid;
            gap: 20px;
            grid-template-columns: repeat(3, 1fr);
            padding: 10px;
            background: var(--bg-primary);
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .info-item {
            display: flex;
            gap: 5px;
        }

        .info-label {
            font-weight: 600;
            color: var(--text-secondary);
        }

        .info-value {
            color: var(--text-primary);
            font-weight: 600;
        }

        /* Main Content */
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 15px;
            min-height: 0;
            padding-bottom: 15px;
        }

        .projections-link {
            color: var(--accent-color);
            text-decoration: underline;
            margin-left: auto;
            cursor: pointer;
        }

        /* Candidates Grid */
        .candidates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            grid-auto-rows: auto;
            gap: 15px;
            flex: 1;
            min-height: 0;
        }

        .candidate-card {
            background: var(--bg-primary);
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        .candidate-card:hover {
            box-shadow: var(--card-hover-shadow);
            transform: translateY(-2px);
        }

        .candidate-image-wrapper {
            width: 100%;
            height: 270px;
            max-height: 270px;
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
        }

        .candidate-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .rank-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 26px;
            height: 26px;
            border-radius: 50%;
            background: var(--accent-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85rem;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
            z-index: 1;
        }

        .rank-badge.rank-1 {
            background: linear-gradient(135deg, #FFD700, #FFA500);
        }

        .rank-badge.rank-2 {
            background: linear-gradient(135deg, #C0C0C0, #999999);
        }

        .rank-badge.rank-3 {
            background: linear-gradient(135deg, #CD7F32, #8B4513);
        }

        .candidate-info {
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 6px;
            flex: 1;
        }

        .candidate-name {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1.2;
            min-height: 2.4em;
        }

        .party-section {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 0;
            border-top: 1px solid var(--border-color);
            border-bottom: 1px solid var(--border-color);
        }

        .party-flag {
            width: 24px;
            height: 16px;
            object-fit: contain;
            flex-shrink: 0;
        }

        .party-name {
            font-size: 0.7rem;
            color: var(--text-secondary);
            font-weight: 600;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .stats-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
            padding-top: 6px;
        }

        .votes {
            font-size: 1rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .percentage {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-secondary);
        }

        .vote-difference {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 8px;
            background: linear-gradient(135deg, rgba(0, 190, 229, 0.1), rgba(0, 190, 229, 0.05));
            border-top: 2px solid var(--accent-color);
            margin-top: 8px;
            border-radius: 6px;
            font-size: 0.85rem;
            justify-content: space-between;
        }

        .vote-difference.negative {
            background: linear-gradient(135deg, rgba(220, 53, 69, 0.12), rgba(220, 53, 69, 0.06));
            border-top: 2px solid #dc3545;
            color: #dc3545;
        }

        .vote-difference.negative.warning {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.18), rgba(255, 193, 7, 0.08));
            border-top: 2px solid rgba(214, 162, 7, 0.18);
            color: #dc3545;
        }

        .vote-difference-label {
            color: var(--text-secondary);
            font-weight: 600;
        }

        .vote-difference-value {
            color: var(--accent-color);
            font-weight: 700;
            font-size: 0.95rem;
        }

        .vote-difference.negative .vote-difference-value {
            color: #dc3545;
            font-weight: 700;
            font-size: 0.95rem;
        }

        /* Department Differences Section */
        .dept-details-checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            user-select: none;
        }

        .dept-details-checkbox-wrapper input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .dept-details-checkbox-label {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .dept-details-checkbox-wrapper:hover .dept-details-checkbox-label {
            color: var(--text-primary);
        }

        .dept-differences-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .dept-differences-content.expanded {
            max-height: 400px;
            overflow-y: auto;
        }

        .dept-differences-list {
            padding: 8px 0;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .dept-difference-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 8px;
            background: var(--bg-secondary);
            border-radius: 4px;
            font-size: 0.75rem;
            border-left: 3px solid var(--accent-color);
        }

        .dept-difference-item.negative {
            border-left-color: #dc3545;
        }

        .dept-difference-item.warning {
            border-left-color: #ffc107;
        }

        .dept-difference-name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.7rem;
        }

        .dept-difference-value {
            font-weight: 700;
            color: var(--accent-color);
            font-size: 0.75rem;
        }

        .dept-difference-item.negative .dept-difference-value {
            color: #dc3545;
        }

        .dept-difference-item.warning .dept-difference-value {
            color: #d6a207;
        }

        /* Loading and Error States */
        #loading {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex: 1;
            gap: 20px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--border-color);
            border-top-color: var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        #error {
            display: none;
            padding: 20px;
            background: #dc3545;
            color: white;
            border-radius: 8px;
            text-align: center;
        }

        #results {
            display: none;
        }

        /* Responsive Design */
        @media (min-width: 1400px) {
            .candidates-grid {
                grid-template-columns: repeat(5, 1fr);
            }
        }

        @media (max-width: 1350px) {
            .controls {
                grid-template-areas: 'dropdowns' 'info';
            }
        }

        @media (min-width: 1240px) and (max-width: 1399px) {
            .candidates-grid {
                grid-template-columns: repeat(4, 1fr);
            }

            .candidate-name {
                font-size: 0.8rem;
                min-height: 2.2em;
            }

            .party-name {
                font-size: 0.68rem;
            }

            .votes {
                font-size: 0.95rem;
            }

            .percentage {
                font-size: 1.15rem;
            }
        }

        @media (max-width: 1024px) {
            header {
                flex-direction: column;
            }

            header .logo-container {
                flex-direction: column;
            }
        }

        @media (min-width: 1024px) and (max-width: 1239px) {
            .candidates-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (min-width: 768px) and (max-width: 1023px) {
            .candidates-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (min-width: 480px) and (max-width: 767px) {
            .candidates-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .info-bar {
                display: flex;
                flex-direction: column;
                gap: 10px;
            }
        }

        @media (max-width: 479px) {
            .candidates-grid {
                grid-template-columns: 1fr 1fr;
                gap: 12px;
            }

            .container {
                padding: 0 15px;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
                padding: 12px 0;
            }

            .control-group {
                align-items: center;
            }

            select {
                font-size: 0.9rem;
                max-width: 100%;
            }

            .info-bar {
                display: flex;
                flex-direction: column;
                gap: 8px;
                padding: 8px;
                font-size: 0.85rem;
            }

            .candidate-image-wrapper {
                height: 250px;
                max-height: 250px;
            }

            .candidate-info {
                padding: 8px;
            }

            .candidate-name {
                font-size: 0.8rem;
                min-height: auto;
            }

            .party-name {
                font-size: 0.65rem;
            }

            .votes {
                font-size: 0.9rem;
            }

            .percentage {
                font-size: 1.1rem;
            }

            .dept-details-checkbox-label {
                font-size: 0.7rem;
            }

            .dept-details-checkbox-wrapper input[type="checkbox"] {
                width: 16px;
                height: 16px;
            }
        }

        /* Actas Info Section */
        .actas-info {
            background: var(--bg-primary);
            border-radius: 8px;
            box-shadow: var(--card-shadow);
            padding: 12px 15px;
            margin-top: 15px;
            display: none;
        }

        .actas-info.visible {
            display: block;
        }

        .actas-title {
            font-size: 0.95rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 10px;
            text-align: center;
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 6px;
        }

        .actas-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
        }

        .actas-item {
            display: flex;
            flex-direction: column;
            gap: 3px;
            padding: 8px 10px;
            background: var(--bg-secondary);
            border-radius: 6px;
            border-left: 3px solid var(--accent-color);
        }

        .actas-item-label {
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .actas-item-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .actas-item-percentage {
            font-size: 0.75rem;
            color: var(--accent-color);
            font-weight: 600;
        }

        @media (max-width: 767px) {
            .actas-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }

            .actas-item {
                padding: 6px 8px;
            }

            .actas-item-value {
                font-size: 1rem;
            }

            .actas-item-label {
                font-size: 0.65rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo-container">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/2f/Flag_of_Honduras_%282022%E2%80%93present%29.svg/2560px-Flag_of_Honduras_%282022%E2%80%93present%29.svg.png" alt="Honduras 2025">
                <h1>Elecciones 2025</h1>
            </div>

            <div class="controls">
                <div class="control-group">
                    <label class="control-label" for="date-select">Fecha de Corte</label>
                    <select id="date-select">
                        <option value="">Cargando...</option>
                    </select>
                </div>

                <div class="control-group">
                    <label class="control-label" for="state-select">Departamento</label>
                    <select id="state-select">
                        <option value="">Cargando...</option>
                    </select>
                </div>
            </div>
        </header>

        <div id="loading">
            <div class="spinner"></div>
            <p>Cargando resultados...</p>
        </div>

        <div id="error"></div>

        <div id="results" class="main-content">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <label class="dept-details-checkbox-wrapper">
                    <input type="checkbox" id="toggle-dept-details">
                    <span class="dept-details-checkbox-label">Ver detalles por departamento</span>
                </label>
                <a href="https://milandroid.dev/eleccioneshn2025/proyeccion-simple.html" class="projections-link">Ver Análisis</a>
            </div>
            <div id="candidates-list" class="candidates-grid">
                <!-- Candidate cards will be dynamically inserted here -->
            </div>
        </div>

        <!-- Actas Information Section -->
        <div id="actas-info" class="actas-info">
            <div class="actas-title">Información de Actas</div>
            <div id="actas-grid" class="actas-grid">
                <!-- Actas data will be dynamically inserted here -->
            </div>
        </div>
    </div>

    <script>
        // Department code to name mapping
        const DEPARTAMENTOS = {
            "00": "TODOS",
            "01": "ATLANTIDA",
            "02": "COLON",
            "03": "COMAYAGUA",
            "04": "COPAN",
            "05": "CORTES",
            "06": "CHOLUTECA",
            "07": "EL PARAISO",
            "08": "FRANCISCO MORAZAN",
            "09": "GRACIAS A DIOS",
            "10": "INTIBUCA",
            "11": "ISLAS DE LA BAHIA",
            "12": "LA PAZ",
            "13": "LEMPIRA",
            "14": "OCOTEPEQUE",
            "15": "OLANCHO",
            "16": "SANTA BARBARA",
            "17": "VALLE",
            "18": "YORO",
            "20": "VOTO EN EL EXTERIOR"
        };

        // Political parties mapping (key => full name)
        const PARTIDOS = {
            "DC": "PARTIDO DEMOCRATA CRISTIANO DE HONDURAS",
            "Libre": "PARTIDO LIBERTAD Y REFUNDACION",
            "PINU": "PARTIDO INNOVACION Y UNIDAD SOCIAL DEMOCRATA",
            "PLH": "PARTIDO LIBERAL DE HONDURAS",
            "PNH": "PARTIDO NACIONAL DE HONDURAS"
        };

        // Political party logos (key => logo URL)
        const PARTIDOS_LOGOS = {
            "DC": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADgAAAAlCAMAAAAgENppAAAAYFBMVEUAkjr///8AjCnE3soAiR8AjzH0+vYAkTf7/fwAiBsAgwDf7eIomkwWlUAAji7k8OfT5te11r3M49JwtIG72cJHo2GeyqlirnZYqm0Ahg+EvZF9uYuPwpuoz7I1nVOJv5bjrv9+AAAA1ElEQVRIie2T2w6CMAyGt7IjCoyjBxTe/y1tF8QYkS0m3u2/GCzpl7Z/O8aSkv4krWOiJJAEyOddyGMBEGQh4walmlb4WNEeOOemK2QYXORKJMV67QPkC+ROMBjox/gDwqDKy54KPElNyPkiOvxc91N60DJZYmhmRzxvwDQopeoyBmQCU1b5HcGJTLLWxpSKIDgquUawiJrit4w42v1K33rsfI8z9egaN0T0uLrKFlep5Dns6uYcVYQ5W5tjpoBHH7s6VoTVLLSrP7+OLcW9x6SkOD0AUGQIXuxlVPAAAAAASUVORK5CYII=",
            "Libre": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADgAAAAaCAMAAADVPG8RAAAAdVBMVEX////SAADRAADUAB7TABDuubvOAADTABXhd3z89fXcWmH++vrzzc7UABr33d7fam/jhIjww8T009Tsr7H56OjbVFvrqKvYNkDnlpnyyMr78PDTAArvvr/ifIDXLjngcXfljpLVFCXZRE3WJzDeY2jaTFTpoaOonFvCAAAB1klEQVQ4jZ2U65KDIAyFk6h4oSoi3lBbW23f/xEXqHbqbjuzY350kOY7kJMMAP8N/u/MX1HLg2CUHwTPFB/i4ugyHQKLTtIhsAW4ljslRAEcwxAg9/G7cwaqvfeNAPsIYoYMIPHp9I3jRpKz0w70I4BhCAwY4lfQOXrx8+rWzHODDV/BoigcKDMhAptzkhJka3VKIep1anRbFpmCeB63E81VyYLhQtjTzWwz6muiCTpEItyVULDgddWYPLSgh02FHhoH0fMMMilK+0eLKakXJ9b1DgwXgAemswXTuVO8Cq3RA/bjZlKTvJuzgc4c8ogbkDK39oUQo2+1bChq4RO4JpO2oHFEk+fRM57ZGSs/gli4ZIIVNCKotY453wa8Sj+C4d02K6wc6PJCNEdkeb7dUD4t/esqke9Z81cwoxSTnHomQc+T3TmfN5BRbvpIZuTuxCYyTahdH9mzqNkWmHZG4kp9YPO3nmqlzUTFpghufnQQuHK4ViqTMlNcDoOxrGM1qIrdMkjvn0bSSMhyWprr3NyXyziOUZ4klYB6dl0/zWxsnfW7yMpxSaI2kOr3iyambVUaE5a3f3j3aNsg+/IEivczBL3mT3ZDoT8jLoL9p06Ovndgff0B3VgZey9MDFkAAAAASUVORK5CYII=",
            "PINU": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADgAAAA4CAMAAACfWMssAAAAsVBMVEX/////eRH/eRAAWSn/eRL/dgD/cgD/bwD/bQD/dAAAWCr/+/j/eAr//vz+eAD/ew/+383+xqf+7+b+qnr/6t//9vEAURn+vZj+zbL+iTn+wJ7+lFX+0bj/aAD+2MP+gCT+to7+nGH+pG6bah7+kEjvdxIASADp7uuJpZIAThC4yb6bsqP+hi/+sYbPchdXYCTddBWzbRyoax02XSbFcRgkXChNXyR9ZSGQaB+HZiB8nYiIU9ttAAAE1UlEQVRIiY1Xh3bbOgyVaXNJtLZiDUuKV5K2zujLbP//wx4Aajix0gTnxKItXuISAC8Rx/nMYp8x3/v09YQ1mxU+MjVjeomjZNt8A5ZzKQoceJKZgH7ytdRfQ0PFmIxhsOTMtPSLZEzFX7ssOBMRAn1jjvjDpWB8809IabnCvAoHreF7fB4NUyG9upyEZUVtkdww4RGAFohhr+TZSVQxEeU00N3Ct5rJNTz3nBiWwlJ31orpID0DNhAUQ3mLYcIWnpWmx54bIgCemZHnQFyQadpcxQ0mcNMGCexAGp3QViHKagLnOBEmAnMf1rIawp9uZI1ftoL1MTqzlereRe9i4OXwkeO79dn+upVuIYA66101ed701FIsgsiO86GKlry+taOt0C3NzSuppBDwUeUEbLWiCnaySvk9EEpDtNbpZo9lHRnJ2QyNMS4N1VFh1861ZsIu4cS1gUCrLW0MPuJCmtmJGVlAdOicxHsFc3ltt+NFvoCvmtu9h5LPPhiXlk8JRCCXx/GolBygRmGhNO/ddU4p2AWVwPFdbJcIlRHWx4hj7IRujMVnZHuWkuVK4Ok7jjzZ3WEcc6zzgOUfYRToEHcx8gvud8HoHOmky5Pp4TYfC9DjJ0Qf3PkJ0OgB5YWrfeiUSiizKUNKRiRmCzJ0+OK6b8FIwJ6teH1bSClk6Ww1rMaFFMcUj9Cis1nw253P3YcRiXIQ+kpoSB2eu6PgBodMZY6nWA9kT4ADexgjqzyQTJhoDNcghGVStT44FJz0rAcu/nsEmHv/+wQIwdNSSt7uk5XNyjJL1+Ul6dTg8c56PIxAAbko12E8oTvRAOyZnnIV0VQSPwAXix0h3acxOtNALw5PqWISyZ4Ddkq1CeM+nXGYr5I9nFMbnC7fh47o3H0ZgHhEuBK8rZIyD51ACaFBg1GEIdp2zuH1sQfevw1RhXyJLhuydbYck2i0qEMU765Me6YnXFHOQf8EOmF8C7qBZVPcrlEDV8Linly3Q8KziysJBpRpZaB64EujqlXYpyazm3x4fdu9ItSdv+3+/KHTxWQvf06aJ0HjLMej4qFu0aSAseDwikUO1jmEAhmg7yze7OlSpGmYkYPrjkk0Bhzsi3Mpj7dSq4YuZHQ5W0BK3OfxPGKhNoqrKjyDQULwyscbhAHBxeHJfX44AFOGOKyaIyQDoOO5zxKEgcjRHiJlFk9/Himu8PeyuwuMVf9lQqo6QONa49H0e/0KXy/cIY2AdS92Pb+0FZjEukOCCPRCntNV+PfqYgDOL67+4m+J1f1Lxe21S1SVMFacQylpgesb9+rHBdiPK/fmGjO1lcpKY1pINaRl1S2Rwh7qjvH1z183N79+Xnf0a9CWTvlXq48pSeEeEHgpfeiGcEel/PxCzqB8OXZjWV1EA5usLOgq3+jp1gFmBNAdCASsBMe5UYIByRSn5mHZwrUkJpBey/ttBMag460U2IRU3PZLKfYz/Lyna+B6xULGi84ONppasqhvkKCmzHn/AIETglo3kHNG/Qy0O+h4bMmAwmR4soIiApRsnwotFbWdxdAEVtPnqrNEs66VMmbhUKy+ajvJUI8kxQjC6OMpT7/X6Oa1NoJUIejaTyfguutI/2nprU+tILTWM1uViX/5jc6a6HacZ5bh5P8Q/wOsYVNwa1QE+wAAAABJRU5ErkJggg==",
            "PLH": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADgAAAAlCAMAAAAgENppAAAADFBMVEXYHgX////WAADzzMuQ3qFRAAAAKklEQVRIie3ToQEAAAjDsAH//8wPFVONr9sSqWuhHJSBDA1hiLeK3yF1PfVnBJnWhtatAAAAAElFTkSuQmCC",
            "PNH": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADgAAAAlCAMAAAAgENppAAAAQlBMVEUnDeD///8WAN8lB+CYk+3Jx/U+L+LZ2PiIg+vRz/ZfVeWloO+Tjeyalu1DN+Lv7/y5t/J7dOlOQ+PCwPR9d+lYTeXK9I0CAAAAlElEQVRIie2SSQ7EIAwE023IHrL//6sBZdBsioQ5UydfSnTbVFWh8IBIplfXeSaNYZ7YNFmiCJDVki3Q6p7kTQd0rzHR6wfjGeEZwzT0qeaEL6bkwHTzW5udoii5RG9JbfgTNz1mFO0tWqUojFGp+wNc/Va2ze9oVVa02MPld21W4ggZhQdUIs94PLpTZ/J/KhQ+uACtIwMbD73hOgAAAABJRU5ErkJggg=="
        };

        // Candidates mapping (key => candidate name)
        const CANDIDATOS = {
            "DC": "MARIO ENRIQUE RIVERA CALLEJAS",
            "Libre": "RIXI RAMONA MONCADA GODOY",
            "PINU": "JORGE NELSON AVILA GUTIERREZ",
            "PLH": "SALVADOR ALEJANDRO CESAR NASRALLA SALUM",
            "PNH": "NASRY JUAN ASFURA ZABLAH"
        };

        // Candidates images (key => image URL) - Synced from constants.py
        const CANDIDATOS_IMAGENES = {
            "DC": "https://www.laprensa.hn/binrepository/1260x945/0c0/0d0/none/11004/YJOO/9_12620377_20251116165825.jpg",
            "Libre": "https://upload.wikimedia.org/wikipedia/commons/c/ca/Honduran_Minister_of_Defense_Rixi_Moncada_visits_U.S._Southern_Command_%28cropped%29.jpg",
            "PINU": "https://proceso.hn/wp-content/uploads/2021/02/Nelson-Avila.jpg",
            "PLH": "https://upload.wikimedia.org/wikipedia/commons/5/51/Salvador_Nasralla_2022_%28cropped%29.jpg",
            "PNH": "https://upload.wikimedia.org/wikipedia/commons/b/b7/Nasry_Asfura_in_2020_%28close-up%29.jpg",
        };

        // Helper function to get party key from full party name
        function getPartyKey(fullPartyName) {
            for (const [key, name] of Object.entries(PARTIDOS)) {
                if (name === fullPartyName) {
                    return key;
                }
            }
            return null;
        }

        // Political party colors for charts
        const PARTY_COLORS = {
            "DC": "#11992B",
            "Libre": "#DC143C",
            "PINU": "#ffa500",
            "PLH": "#FF0000",
            "PNH": "#1E90FF"
        };

        // Global state
        let availableDates = [];
        let metadataObj = {};
        let currentDate = null;
        let currentState = null;

        // Helper function to get URL query parameters
        function getQueryParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                fecha: params.get('fecha'),
                departamento: params.get('departamento')
            };
        }

        // Helper function to update URL without reloading the page
        function updateURL(fecha, departamento) {
            const params = new URLSearchParams();
            if (fecha) params.set('fecha', fecha);
            if (departamento) params.set('departamento', departamento);

            const newURL = `${window.location.pathname}?${params.toString()}`;
            window.history.replaceState({}, '', newURL);
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            loadMetadata().then(() => {
                loadDefaultView();
            });
        });

        // Load metadata about available result dates
        async function loadMetadata() {
            try {
                const response = await fetch('results_metadata.json');
                if (!response.ok) {
                    throw new Error('Could not load metadata');
                }
                const metadata = await response.json();
                metadataObj = metadata;
                availableDates = metadata.available_dates || [];
                initializeDateSelector();
            } catch (error) {
                console.error('Error loading metadata:', error);
                showError('No se pudo cargar la información de fechas disponibles.');
            }
        }

        // Initialize the date selector dropdown
        function initializeDateSelector() {
            const select = document.getElementById('date-select');
            select.innerHTML = '';

            if (availableDates.length === 0) {
                const option = document.createElement('option');
                option.value = '';
                option.textContent = 'No hay fechas';
                select.appendChild(option);
                return;
            }

            // Add options for each date
            availableDates.forEach(date => {
                const option = document.createElement('option');
                option.value = date;
                option.textContent = formatDateDisplay(date);
                select.appendChild(option);
            });

            // Check if there's a fecha in URL params
            const queryParams = getQueryParams();
            if (queryParams.fecha && availableDates.includes(queryParams.fecha)) {
                select.value = queryParams.fecha;
                currentDate = queryParams.fecha;
            } else {
                // Set the newest date as default
                select.value = availableDates[0];
                currentDate = availableDates[0];
            }

            // Add event listener for date change
            select.addEventListener('change', (e) => {
                currentDate = e.target.value;
                if (currentDate) {
                    // Update URL with new fecha
                    updateURL(currentDate, currentState);
                    // Load states for this date
                    loadStatesForDate(currentDate);
                }
            });
        }

        // Default list of all states
        const ALL_STATES = [
            "TODOS",
            "ATLANTIDA",
            "CHOLUTECA",
            "COLON",
            "COMAYAGUA",
            "COPAN",
            "CORTES",
            "EL PARAISO",
            "FRANCISCO MORAZAN",
            "GRACIAS A DIOS",
            "INTIBUCA",
            "ISLAS DE LA BAHIA",
            "LA PAZ",
            "LEMPIRA",
            "OCOTEPEQUE",
            "OLANCHO",
            "SANTA BARBARA",
            "VALLE",
            "VOTO EN EL EXTERIOR",
            "YORO"
        ];

        // Load available states for a specific date
        function loadStatesForDate(date) {
            const dateData = metadataObj.dates[date];
            if (!dateData) {
                console.error('No data found for date:', date);
                return;
            }

            let states;
            if (!dateData.states) {
                // No states property means all states are available
                states = ALL_STATES;
            } else if (dateData.states.length === 0) {
                // Empty array means no options available
                states = [];
            } else {
                // Specific states are available
                states = dateData.states;
            }

            // Check if there's a departamento in URL params
            const queryParams = getQueryParams();
            let initialState = states[0]; // default to first state

            if (queryParams.departamento && states.includes(queryParams.departamento)) {
                initialState = queryParams.departamento;
            }

            initializeStateSelector(states, initialState);

            // Load the selected state
            if (states.length > 0) {
                currentState = initialState;
                // Update URL with current selection
                updateURL(currentDate, currentState);
                loadResults(currentDate, currentState);
            }
        }

        // Initialize the state selector dropdown with available states
        function initializeStateSelector(states, initialState = null) {
            const select = document.getElementById('state-select');

            // Remove previous event listener by cloning
            const newSelect = select.cloneNode(false);
            select.parentNode.replaceChild(newSelect, select);

            // Clear and populate options
            newSelect.innerHTML = '';

            if (!states || states.length === 0) {
                const option = document.createElement('option');
                option.value = '';
                option.textContent = 'No hay estados';
                newSelect.appendChild(option);
                return;
            }

            // Add options for each state
            states.forEach(state => {
                const option = document.createElement('option');
                option.value = state;
                option.textContent = state;
                newSelect.appendChild(option);
            });

            // Set the initial state (from URL or default)
            const stateToSelect = initialState || states[0];
            newSelect.value = stateToSelect;
            currentState = stateToSelect;

            // Add event listener for state change
            newSelect.addEventListener('change', (e) => {
                currentState = e.target.value;
                if (currentDate && currentState) {
                    // Update URL with new departamento
                    updateURL(currentDate, currentState);
                    loadResults(currentDate, currentState);
                }
            });
        }

        // Load default view (newest date, TODOS state)
        async function loadDefaultView() {
            if (availableDates.length > 0) {
                // currentDate is already set by initializeDateSelector()
                // Don't overwrite it here
                loadStatesForDate(currentDate);
            }
        }

        // Format date for display
        function formatDateDisplay(dateString) {
            const parts = dateString.split('_');
            if (parts.length !== 2) return dateString;

            const datePart = parts[0].split('-');
            const timePart = parts[1].split('-');

            if (datePart.length !== 3 || timePart.length !== 3) return dateString;

            return `${datePart[2]}/${datePart[1]}/${datePart[0]} ${timePart[0]}:${timePart[1]}`;
        }

        // Load results for a specific date and state
        async function loadResults(date, state) {
            const loadingEl = document.getElementById('loading');
            const errorEl = document.getElementById('error');
            const resultsEl = document.getElementById('results');

            // Show loading state
            loadingEl.style.display = 'flex';
            errorEl.style.display = 'none';
            resultsEl.style.display = 'none';

            try {
                const filePath = `results/${date}/${state}.json`;
                const response = await fetch(filePath);

                if (!response.ok) {
                    throw new Error(`No se pudo cargar los datos para ${state}`);
                }

                const data = await response.json();

                // Hide loading and show results
                loadingEl.style.display = 'none';
                resultsEl.style.display = 'flex';

                // Display the data
                displayResults(data, state);

            } catch (error) {
                console.error('Error loading data:', error);
                loadingEl.style.display = 'none';
                showError(`Error: ${error.message}`);
            }
        }

        // Display error message
        function showError(message) {
            const errorEl = document.getElementById('error');
            errorEl.textContent = message;
            errorEl.style.display = 'block';
        }

        // Display the election results
        function displayResults(data, stateName) {
            // Calculate total votes
            const totalVotos = data.candidatos.reduce((sum, candidato) => sum + (candidato.votos || 0), 0);
            // Sort candidates by votes (descending)
            const candidatosSorted = [...data.candidatos].sort((a, b) => (b.votos || 0) - (a.votos || 0));

            // Display candidates cards
            displayCandidateCards(candidatosSorted, totalVotos);

            // Initialize department toggle button
            initializeDepartmentToggle();

            // Display actas information if available
            if (data.actas) {
                displayActasInfo(data.actas);
            } else {
                hideActasInfo();
            }
        }

        // Display actas information
        function displayActasInfo(actas) {
            const actasContainer = document.getElementById('actas-info');
            const actasGrid = document.getElementById('actas-grid');

            // Clear previous content
            actasGrid.innerHTML = '';

            // Calculate percentage for publicadas/total
            const percentage = actas.total > 0 ? ((actas.correctas / actas.total) * 100).toFixed(2) : 0;

            // Define the actas items to display
            const actasItems = [
                { label: 'Total', value: actas.total },
                { label: 'Publicadas', value: actas.publicadas, percentage: actas.total > 0 ? ((actas.publicadas / actas.total) * 100).toFixed(2) : 0 },
                { label: 'En Espera', value: actas.espera, percentage: actas.total > 0 ? ((actas.espera / actas.total) * 100).toFixed(2) : 0 },
                { label: 'En Verificación', value: actas.verificacion, percentage: actas.total > 0 ? ((actas.verificacion / actas.total) * 100).toFixed(2) : 0 },
                { label: 'Correctas', value: actas.correctas, percentage: percentage },
                { label: 'Inconsistencias', value: actas.inconsistencias, percentage: actas.total > 0 ? ((actas.inconsistencias / actas.total) * 100).toFixed(2) : 0  },
                { label: 'Pend. Verificación', value: actas.pendientesVerificacionVisual, percentage: actas.total > 0 ? ((actas.pendientesVerificacionVisual / actas.total) * 100).toFixed(2) : 0  }
            ];

            // Create and append actas items
            actasItems.forEach(item => {
                const actasItem = createActasItem(item.label, item.value, item.percentage);
                actasGrid.appendChild(actasItem);
            });

            // Show the actas container
            actasContainer.classList.add('visible');
        }

        // Hide actas information section
        function hideActasInfo() {
            const actasContainer = document.getElementById('actas-info');
            actasContainer.classList.remove('visible');
        }

        // Create an actas item element
        function createActasItem(label, value, percentage = null) {
            const item = document.createElement('div');
            item.className = 'actas-item';

            const labelEl = document.createElement('div');
            labelEl.className = 'actas-item-label';
            labelEl.textContent = label;
            item.appendChild(labelEl);

            const valueEl = document.createElement('div');
            valueEl.className = 'actas-item-value';
            valueEl.textContent = (value || 0).toLocaleString('es-HN');
            valueEl.style.display = 'flex';
            valueEl.style.alignItems = 'center';
            valueEl.style.justifyContent = 'space-between';
            valueEl.style.width = '100%';
            valueEl.style.flexWrap = "wrap";

            if (percentage !== null && percentage !== undefined) {
                const percentageEl = document.createElement('div');
                percentageEl.className = 'actas-item-percentage';
                percentageEl.textContent = `${percentage}%`;
                valueEl.appendChild(percentageEl);
            }

            item.appendChild(valueEl);

            return item;
        }

        // Display candidate cards
        function displayCandidateCards(candidatos, totalVotos) {
            const container = document.getElementById('candidates-list');
            container.innerHTML = '';

            candidatos.forEach((candidato, index) => {
                const percentage = totalVotos > 0 ? ((candidato.votos / totalVotos) * 100).toFixed(2) : 0;
                const partyKey = getPartyKey(candidato.parpo_nombre);
                const voteDifference = index === 0 ? candidatos[0].votos - candidatos[1].votos: candidato.votos - candidatos[0].votos;

                // Pass vote difference only to the first candidate
                const card = createCandidateCard(candidato, percentage, index + 1, partyKey, voteDifference);
                container.appendChild(card);
            });
        }

        // Create a candidate card element
        function createCandidateCard(candidato, percentage, position, partyKey, voteDifference = null) {
            const card = document.createElement('div');
            card.className = 'candidate-card';

            // Image wrapper with rank badge
            const imageWrapper = document.createElement('div');
            imageWrapper.className = 'candidate-image-wrapper';

            // Rank badge
            const rankBadge = document.createElement('div');
            rankBadge.className = `rank-badge rank-${Math.min(position, 3)}`;
            rankBadge.textContent = position;
            imageWrapper.appendChild(rankBadge);

            // Candidate image
            const img = document.createElement('img');
            img.className = 'candidate-image';
            img.src = partyKey && CANDIDATOS_IMAGENES[partyKey] ? CANDIDATOS_IMAGENES[partyKey] : 'https://via.placeholder.com/300?text=No+Image';
            img.alt = candidato.cddto_nombres;
            img.onerror = function() {
                this.src = 'https://via.placeholder.com/300?text=No+Image';
            };
            imageWrapper.appendChild(img);

            card.appendChild(imageWrapper);

            // Candidate info section
            const info = document.createElement('div');
            info.className = 'candidate-info';

            // Candidate name
            const name = document.createElement('div');
            name.className = 'candidate-name';
            name.textContent = candidato.cddto_nombres;
            info.appendChild(name);

            // Party section with flag and name
            const partySection = document.createElement('div');
            partySection.className = 'party-section';

            if (partyKey && PARTIDOS_LOGOS[partyKey]) {
                const partyFlag = document.createElement('img');
                partyFlag.className = 'party-flag';
                partyFlag.src = PARTIDOS_LOGOS[partyKey];
                partyFlag.alt = candidato.parpo_nombre;
                partyFlag.onerror = function() {
                    this.style.display = 'none';
                };
                partySection.appendChild(partyFlag);
            }

            const partyName = document.createElement('div');
            partyName.className = 'party-name';
            partyName.textContent = candidato.parpo_nombre;
            partySection.appendChild(partyName);

            info.appendChild(partySection);

            // Stats section with votes and percentage
            const statsSection = document.createElement('div');
            statsSection.className = 'stats-section';

            const votes = document.createElement('div');
            votes.className = 'votes';
            votes.textContent = (candidato.votos || 0).toLocaleString('es-HN');
            statsSection.appendChild(votes);

            const percentageDiv = document.createElement('div');
            percentageDiv.className = 'percentage';
            percentageDiv.textContent = `${percentage}%`;
            statsSection.appendChild(percentageDiv);

            info.appendChild(statsSection);

            // Add vote difference section for all candidates
            if (voteDifference !== null) {
                const diffSection = document.createElement('div');
                let classes = 'vote-difference';
                if (voteDifference < 0) {
                    classes += ' negative';
                }
                if (voteDifference > -50000 && voteDifference < 0) {
                    classes += ' warning';
                }
                diffSection.className = classes;

                const diffLabel = document.createElement('span');
                diffLabel.className = 'vote-difference-label';
                diffLabel.textContent = 'Diferencia:';
                diffSection.appendChild(diffLabel);

                const diffValue = document.createElement('span');
                diffValue.className = 'vote-difference-value';
                diffValue.textContent = `${voteDifference > 0 ? '+' : ''}${voteDifference.toLocaleString('es-HN')}`;
                diffSection.appendChild(diffValue);

                info.appendChild(diffSection);
            }

            // Add department differences content section (hidden by default)
            const deptContent = document.createElement('div');
            deptContent.className = 'dept-differences-content';
            deptContent.innerHTML = '<div class="dept-differences-list" data-party="' + partyKey + '"></div>';

            info.appendChild(deptContent);

            card.appendChild(info);

            return card;
        }

        // Function to load department differences for a specific party
        async function loadDepartmentDifferences(partyKey, containerElement) {
            // Show loading state
            containerElement.innerHTML = '<div style="text-align: center; padding: 10px; color: var(--text-secondary);">Cargando...</div>';

            try {
                const partyName = PARTIDOS[partyKey];
                if (!partyName) {
                    containerElement.innerHTML = '<div style="text-align: center; padding: 10px; color: var(--text-secondary);">No hay datos disponibles</div>';
                    return;
                }

                // Get all departments except "TODOS"
                const departments = ALL_STATES.filter(dept => dept !== 'TODOS');
                const departmentDifferences = [];

                // Load data for each department
                for (const dept of departments) {
                    try {
                        const filePath = `results/${currentDate}/${dept}.json`;
                        const response = await fetch(filePath);

                        if (!response.ok) continue;

                        const data = await response.json();

                        // Find the candidate for this party
                        const candidate = data.candidatos.find(c => c.parpo_nombre === partyName);
                        if (!candidate) continue;

                        // Sort candidates by votes to find positions
                        const sortedCandidates = [...data.candidatos].sort((a, b) => b.votos - a.votos);
                        const firstPlace = sortedCandidates[0];
                        const secondPlace = sortedCandidates[1];

                        let difference;

                        // Check if this candidate is in first place
                        if (candidate.votos === firstPlace.votos) {
                            // First place: compare with second place
                            difference = candidate.votos - (secondPlace ? secondPlace.votos : 0);
                        } else {
                            // Not first place: compare with first place (will be negative or zero)
                            difference = candidate.votos - firstPlace.votos;
                        }

                        // Include all differences
                        departmentDifferences.push({
                            department: dept,
                            difference: difference
                        });
                    } catch (error) {
                        console.error(`Error loading data for ${dept}:`, error);
                    }
                }

                // Sort by difference (most negative first, positive last)
                departmentDifferences.sort((a, b) => a.difference - b.difference);

                // Display the results
                if (departmentDifferences.length === 0) {
                    containerElement.innerHTML = '<div style="text-align: center; padding: 10px; color: var(--text-secondary);">No hay diferencias disponibles</div>';
                    return;
                }

                containerElement.innerHTML = '';
                departmentDifferences.forEach(item => {
                    const diffItem = document.createElement('div');
                    let classes = 'dept-difference-item';

                    // Apply color classes based on difference
                    if (item.difference < -20000) {
                        classes += ' negative';
                    } else if (item.difference < 0) {
                        classes += ' warning';
                    }
                    // Positive values will use default (accent color)

                    diffItem.className = classes;

                    const deptName = document.createElement('span');
                    deptName.className = 'dept-difference-name';
                    deptName.textContent = item.department;

                    const deptValue = document.createElement('span');
                    deptValue.className = 'dept-difference-value';
                    deptValue.textContent = `${item.difference > 0 ? '+' : ''}${item.difference.toLocaleString('es-HN')}`;

                    diffItem.appendChild(deptName);
                    diffItem.appendChild(deptValue);

                    containerElement.appendChild(diffItem);
                });

            } catch (error) {
                console.error('Error loading department differences:', error);
                containerElement.innerHTML = '<div style="text-align: center; padding: 10px; color: #dc3545;">Error al cargar datos</div>';
            }
        }

        // Global toggle for department details
        let departmentToggleInitialized = false;

        function initializeDepartmentToggle() {
            if (departmentToggleInitialized) return;

            const toggleCheckbox = document.getElementById('toggle-dept-details');
            if (!toggleCheckbox) return;

            toggleCheckbox.addEventListener('change', async () => {
                if (toggleCheckbox.checked) {
                    // Expand all department details
                    const allContents = document.querySelectorAll('.dept-differences-content');
                    allContents.forEach(content => {
                        content.classList.add('expanded');
                        const list = content.querySelector('.dept-differences-list');
                        const partyKey = list.getAttribute('data-party');
                        if (partyKey && list.children.length === 0) {
                            // Only load if not already loaded
                            loadDepartmentDifferences(partyKey, list);
                        }
                    });
                } else {
                    // Collapse all department details
                    const allContents = document.querySelectorAll('.dept-differences-content');
                    allContents.forEach(content => {
                        content.classList.remove('expanded');
                    });
                }
            });

            departmentToggleInitialized = true;
        }

        // Function to refresh metadata and update dropdowns
        async function refreshMetadata() {
            try {
                const response = await fetch(`results_metadata.json?cache_bust=${Date.now()}`);
                if (!response.ok) {
                    return;
                }
                const metadata = await response.json();
                const newAvailableDates = metadata.available_dates || [];

                // Check if there are new dates
                if (newAvailableDates.length > availableDates.length ||
                    newAvailableDates[0] !== availableDates[0]) {

                    const oldCurrentDate = currentDate;
                    const oldLatestDate = availableDates[0];

                    // Check if user is viewing the latest date (before the update)
                    const wasViewingLatest = oldCurrentDate === oldLatestDate;

                    // Update metadata
                    metadataObj = metadata;
                    availableDates = newAvailableDates;

                    if (wasViewingLatest) {
                        // User was viewing the latest, do a full reload to get new data
                        window.location.href = window.location.href.split('?')[0] + `?cache_bust=${Date.now()}`;
                    } else {
                        // User is viewing an older date, just refresh the dropdown options
                        refreshDateDropdown();
                    }
                }
            } catch (error) {
                console.error('Error refreshing metadata:', error);
            }
        }

        // Function to refresh the date dropdown while keeping current selection
        function refreshDateDropdown() {
            const select = document.getElementById('date-select');
            const currentValue = select.value;

            // Clear and repopulate
            select.innerHTML = '';

            availableDates.forEach(date => {
                const option = document.createElement('option');
                option.value = date;
                option.textContent = formatDateDisplay(date);
                select.appendChild(option);
            });

            // Restore the previous selection if it still exists
            if (availableDates.includes(currentValue)) {
                select.value = currentValue;
            } else {
                // If the selected date no longer exists, select the latest
                select.value = availableDates[0];
                currentDate = availableDates[0];
                loadStatesForDate(currentDate);
            }
        }

        // Auto-refresh every 100 seconds
        setInterval(refreshMetadata, 100000);

    </script>
</body>
</html>
