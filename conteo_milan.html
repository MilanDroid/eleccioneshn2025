<!DOCTYPE html>
<html lang="es">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-3Y9JPR9BW0"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-3Y9JPR9BW0');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resultados Electorales - Honduras 2025</title>
    <link rel="stylesheet" href="https://milandroid.dev/eleccioneshn2025/style.css">

    <style>
        /* Theme Variables */
        :root {
            --accent-color: #00bee5;
            --accent-hover: #00a5cc;
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --text-primary: #1a1a1a;
            --text-secondary: #6c757d;
            --border-color: #e0e0e0;
            --card-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            --card-hover-shadow: 0 4px 12px rgba(0, 190, 229, 0.2);
        }

        [data-theme="dark"] {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --text-primary: #f5f5f5;
            --text-secondary: #b0b0b0;
            --border-color: #404040;
            --card-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            --card-hover-shadow: 0 4px 12px rgba(0, 190, 229, 0.3);
        }

        /* Theme-specific overrides */
        body {
            background: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            height: auto;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        header {
            padding: 5px 0 5px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
            flex-wrap: wrap;
        }

        header > div {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        header img {
            max-width: 100px;
        }

        header h1 {
            margin-left: 0.5rem;
            color: var(--text-secondary)
        }

        /* Controls Section */
        .controls {
            padding: 15px 0;
            display: flex;
            gap: 15px;
            align-items: center;
            justify-content: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
            min-width: 250px;
        }

        .control-label {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        select {
            padding: 10px 15px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            max-width: 270px;
            min-width: 100%;
        }

        select:hover {
            border-color: var(--accent-color);
        }

        select:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(0, 190, 229, 0.1);
        }

        .info-bar {
            display: grid;
            gap: 20px;
            grid-template-columns: repeat(3, 1fr);
            padding: 10px;
            background: var(--bg-primary);
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .info-item {
            display: flex;
            gap: 5px;
        }

        .info-label {
            font-weight: 600;
            color: var(--text-secondary);
        }

        .info-value {
            color: var(--text-primary);
            font-weight: 600;
        }

        /* Main Content */
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 15px;
            min-height: 0;
            padding-bottom: 15px;
        }

        .projections-link {
            color: var(--accent-color);
            text-decoration: underline;
            margin-left: auto;
            cursor: pointer;
        }

        /* Candidates Grid */
        .candidates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            grid-auto-rows: auto;
            gap: 15px;
            flex: 1;
            min-height: 0;
        }

        /* Center candidates when only 2 are visible */
        .candidates-grid.two-candidates-mode {
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .candidate-card {
            background: var(--bg-primary);
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        .candidate-card.hidden-candidate {
            display: none;
        }

        .candidate-card:hover {
            box-shadow: var(--card-hover-shadow);
            transform: translateY(-2px);
        }

        /* Split layout for two candidates mode with expanded details on desktop */
        @media (min-width: 768px) {
            .candidates-grid.two-candidates-mode .candidate-card.split-layout {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 20px;
                max-height: 500px;
            }

            /* First candidate: default order (main content left, departments right) */
            .candidates-grid.two-candidates-mode .candidate-card.split-layout:nth-child(1) {
                grid-template-areas: 'candidate-info department-info';
            }

            .candidates-grid.two-candidates-mode .candidate-card.split-layout:nth-child(1) .card-main-content {
                display: flex;
                flex-direction: column;
                overflow-y: auto;
                grid-area: candidate-info;
            }

            .candidates-grid.two-candidates-mode .candidate-card.split-layout:nth-child(1) .dept-differences-content {
                overflow-y: auto;
                padding-left: 20px;
                border-left: 2px solid var(--border-color);
                grid-area: department-info;
            }

            /* Second candidate: reversed order (departments left, main content right) */
            .candidates-grid.two-candidates-mode .candidate-card.split-layout:nth-child(2) {
                grid-template-areas: 'department-info candidate-info';
            }

            .candidates-grid.two-candidates-mode .candidate-card.split-layout:nth-child(2) .card-main-content {
                display: flex;
                flex-direction: column;
                overflow-y: auto;
                grid-area: candidate-info;
            }

            .candidates-grid.two-candidates-mode .candidate-card.split-layout:nth-child(2) .dept-differences-content {
                overflow-y: auto;
                padding-right: 20px;
                border-right: 2px solid var(--border-color);
                grid-area: department-info;
            }
        }

        .candidate-image-wrapper {
            width: 100%;
            max-width: 350px;
            margin: auto auto;
            height: 270px;
            max-height: 270px;
            position: relative;
            overflow: hidden;
            background: var(--bg-secondary);
        }

        .candidate-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .rank-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 26px;
            height: 26px;
            border-radius: 50%;
            background: var(--accent-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85rem;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
            z-index: 1;
        }

        .rank-badge.rank-1 {
            background: #FFD700;
        }

        .rank-badge.rank-2 {
            background: #C0C0C0;
        }

        .rank-badge.rank-3 {
            background: #CD7F32;
        }

        .candidate-info {
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 6px;
            flex: 1;
        }

        .candidate-name {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1.2;
            min-height: 2.4em;
        }

        .party-section {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 0;
            border-top: 1px solid var(--border-color);
            border-bottom: 1px solid var(--border-color);
        }

        .party-flag {
            width: 24px;
            height: 16px;
            object-fit: contain;
            flex-shrink: 0;
        }

        .party-name {
            font-size: 0.7rem;
            color: var(--text-secondary);
            font-weight: 600;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .stats-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
            padding-top: 6px;
        }

        .votes {
            font-size: 1rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .percentage {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-secondary);
        }

        .vote-difference {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 8px;
            background: rgba(0, 190, 229, 0.1);
            border-top: 2px solid var(--accent-color);
            margin-top: 8px;
            border-radius: 6px;
            font-size: 0.85rem;
            justify-content: space-between;
        }

        .vote-difference.negative {
            background: rgba(220, 53, 69, 0.1);
            border-top: 2px solid #dc3545;
            color: #dc3545;
        }

        .vote-difference.negative.warning {
            background: rgba(255, 193, 7, 0.15);
            border-top: 2px solid rgba(214, 162, 7, 0.18);
            color: #dc3545;
        }

        .vote-difference-label {
            color: var(--text-secondary);
            font-weight: 600;
        }

        .vote-difference-value {
            color: var(--accent-color);
            font-weight: 700;
            font-size: 0.95rem;
        }

        .vote-difference.negative .vote-difference-value {
            color: #dc3545;
            font-weight: 700;
            font-size: 0.95rem;
        }

        /* Department Differences Section */
        .dept-details-checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            user-select: none;
        }


        .dept-details-checkbox-wrapper input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .dept-details-checkbox-label {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .dept-details-checkbox-wrapper:hover .dept-details-checkbox-label {
            color: var(--text-primary);
        }

        .dept-differences-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .dept-differences-content.expanded {
            max-height: 465px;
            overflow-y: auto;
        }

        .dept-differences-list {
            padding: 8px 0;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .dept-difference-item {
            display: grid;
            grid-template-columns: 1fr auto;
            grid-template-rows: auto;
            gap: 4px 8px;
            padding: 6px 8px;
            background: var(--bg-secondary);
            border-radius: 4px;
            font-size: 0.75rem;
            border-left: 3px solid var(--accent-color);
        }

        .dept-difference-item.negative {
            border-left-color: #dc3545;
        }

        .dept-difference-item.warning {
            border-left-color: #ffc107;
        }

        .dept-difference-name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.7rem;
            grid-area: 'name';
        }

        .dept-difference-percentage {
            font-size: 0.65rem;
            color: var(--text-secondary);
            font-weight: 500;
            grid-area: 'percentage';
        }

        .dept-difference-value {
            grid-column: 2;
            grid-row: 1;
            font-weight: 700;
            color: var(--accent-color);
            font-size: 0.75rem;
            text-align: right;
            grid-area: 'difference';
        }

        .dept-difference-item.negative .dept-difference-value {
            color: #dc3545;
        }

        .dept-difference-item.warning .dept-difference-value {
            color: #d6a207;
        }

        /* Loading and Error States */
        #loading {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex: 1;
            gap: 20px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--border-color);
            border-top-color: var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        #error {
            display: none;
            padding: 20px;
            background: #dc3545;
            color: white;
            border-radius: 8px;
            text-align: center;
        }

        #results {
            display: none;
        }

        /* Responsive Design */
        @media (min-width: 1400px) {
            .candidates-grid {
                grid-template-columns: repeat(5, 1fr);
            }
        }

        @media (max-width: 1350px) {
            .controls {
                grid-template-areas: 'dropdowns' 'info';
            }
        }

        @media (min-width: 1240px) and (max-width: 1399px) {
            .candidates-grid {
                grid-template-columns: repeat(4, 1fr);
            }

            .candidate-name {
                font-size: 0.8rem;
                min-height: 2.2em;
            }

            .party-name {
                font-size: 0.68rem;
            }

            .votes {
                font-size: 0.95rem;
            }

            .percentage {
                font-size: 1.15rem;
            }
        }

        @media (max-width: 1024px) {
            header {
                flex-direction: column;
            }

            header .logo-container {
                flex-direction: column;
            }
        }

        @media (min-width: 1024px) and (max-width: 1239px) {
            .candidates-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (min-width: 768px) and (max-width: 1023px) {
            .candidates-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (min-width: 480px) and (max-width: 767px) {
            .candidates-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .candidates-grid.two-candidates-mode {
                grid-template-columns: repeat(2, 1fr);
            }

            .info-bar {
                display: flex;
                flex-direction: column;
                gap: 10px;
            }
        }

        @media (max-width: 479px) {
            .candidates-grid {
                grid-template-columns: 1fr 1fr;
                gap: 12px;
            }

            .candidates-grid.two-candidates-mode {
                grid-template-columns: 1fr 1fr;
                max-width: 100%;
            }

            .container {
                padding: 0 15px;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
                padding: 12px 0;
            }

            .control-group {
                align-items: center;
            }

            select {
                font-size: 0.9rem;
                max-width: 100%;
            }

            .info-bar {
                display: flex;
                flex-direction: column;
                gap: 8px;
                padding: 8px;
                font-size: 0.85rem;
            }

            .candidate-image-wrapper {
                height: 250px;
                max-height: 250px;
            }

            .candidate-info {
                padding: 8px;
            }

            .candidate-name {
                font-size: 0.8rem;
                min-height: auto;
            }

            .party-name {
                font-size: 0.65rem;
            }

            .votes {
                font-size: 0.9rem;
            }

            .percentage {
                font-size: 1.1rem;
            }

            .dept-details-checkbox-label {
                font-size: 0.7rem;
            }

            .dept-details-checkbox-wrapper input[type="checkbox"] {
                width: 16px;
                height: 16px;
            }

            /* Smaller font for department details on mobile */
            .dept-difference-item {
                font-size: 0.65rem;
                padding: 4px 6px;
                grid-template-columns: 1fr auto;
                grid-template-rows: auto auto;
                gap: 2px 8px;
            }

            .dept-difference-name {
                font-size: 0.6rem;
                grid-column: 1 / -1;
                grid-row: 1;
            }

            .dept-difference-percentage {
                font-size: 0.55rem;
            }

            .dept-difference-value {
                font-size: 0.65rem;
                grid-column: 2;
                grid-row: 2;
            }
        }

        /* Actas Info Section */
        .actas-info {
            background: var(--bg-primary);
            border-radius: 8px;
            box-shadow: var(--card-shadow);
            padding: 12px 15px;
            margin-top: 15px;
            display: none;
        }

        .actas-info.visible {
            display: block;
        }

        .actas-title {
            font-size: 0.95rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 10px;
            text-align: center;
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 6px;
        }

        .actas-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
        }

        .actas-item {
            display: flex;
            flex-direction: column;
            gap: 3px;
            padding: 8px 10px;
            background: var(--bg-secondary);
            border-radius: 6px;
            border-left: 3px solid var(--accent-color);
        }

        .actas-item-label {
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .actas-item-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .actas-item-percentage {
            font-size: 0.75rem;
            color: var(--accent-color);
            font-weight: 600;
        }

        @media (max-width: 767px) {
            .actas-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }

            .actas-item {
                padding: 6px 8px;
            }

            .actas-item-value {
                font-size: 1rem;
            }

            .actas-item-label {
                font-size: 0.65rem;
            }

            .dept-difference-item {
                grid-template-areas: 'name name' 'percentage difference';
            }
        }

        /* Mismatches Table Styles */
        .acta-list-item {
            display: grid;
            grid-template-columns: 1.5fr 1.5fr 2.5fr 1fr 1.2fr 0.8fr 0.8fr 0.8fr 0.8fr 0.8fr 0.8fr;
            gap: 8px;
            padding: 10px;
            background: var(--bg-secondary);
            border-radius: 6px;
            border-left: 3px solid var(--accent-color);
            margin-bottom: 8px;
            font-size: 0.75rem;
            align-items: center;
        }

        .acta-list-item > div {
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .acta-list-header {
            display: grid;
            grid-template-columns: 1.5fr 1.5fr 2.5fr 1fr 1.2fr 0.8fr 0.8fr 0.8fr 0.8fr 0.8fr 0.8fr;
            gap: 8px;
            padding: 10px;
            font-weight: 700;
            color: var(--text-secondary);
            font-size: 0.75rem;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 10px;
        }

        .acta-link {
            color: var(--accent-color);
            text-decoration: underline;
            cursor: pointer;
            font-weight: 600;
        }

        .acta-link:hover {
            color: var(--accent-hover);
        }

        /* Pagination Styles */
        .pagination-btn {
            padding: 8px 12px;
            border: 2px solid var(--border-color);
            background: var(--bg-secondary);
            color: var(--text-primary);
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .pagination-btn:hover:not(:disabled) {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-btn.active {
            background: var(--bg-primary);
            color: var(--accent-color);
            border: 2px solid var(--accent-color);
        }

        /* Actas Filters Styles */
        .actas-filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            padding: 15px;
            background: var(--bg-primary);
            border-radius: 8px;
            margin: 15px 0;
            box-shadow: var(--card-shadow);
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-select {
            padding: 8px 12px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-select:hover {
            border-color: var(--accent-color);
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(0, 190, 229, 0.1);
        }

        .filter-input {
            padding: 8px 12px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }

        .filter-input:hover {
            border-color: var(--accent-color);
        }

        .filter-input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(0, 190, 229, 0.1);
        }

        .clear-filters-btn {
            padding: 8px 12px;
            border: 2px solid var(--border-color);
            background: var(--bg-secondary);
            color: var(--text-primary);
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-top: auto;
        }

        .clear-filters-btn:hover {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
            transform: translateY(-2px);
        }

        .actas-list-scroll-wrapper {
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        @media (max-width: 767px) {
            .actas-filters {
                grid-template-columns: 1fr;
                gap: 10px;
                padding: 10px;
            }

            .actas-list-scroll-wrapper {
                margin: 0 -15px;
                padding: 0 15px;
            }

            #mismatches-list {
                min-width: 900px;
            }

            .acta-list-item {
                font-size: 0.65rem;
                white-space: nowrap;
            }

            .acta-list-header {
                font-size: 0.65rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="navbar-container">
            <a href="https://milandroid.dev/eleccioneshn2025/index.html" class="navbar-brand">
                <img style="max-width: 60px" src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/2f/Flag_of_Honduras_%282022%E2%80%93present%29.svg/2560px-Flag_of_Honduras_%282022%E2%80%93present%29.svg.png" alt="Honduras 2025">
                HN 2025
            </a>
            <button class="navbar-toggle" onclick="toggleMenu()">☰</button>
            <ul class="navbar-menu" id="navbarMenu">
                <li class="navbar-item"><a href="https://milandroid.dev/eleccioneshn2025/actas.html" class="navbar-link">Actas</a></li>
                <li class="navbar-item"><a href="https://milandroid.dev/eleccioneshn2025/index.html" class="navbar-link">Conteo CNE</a></li>
                <li class="navbar-item"><a href="https://milandroid.dev/eleccioneshn2025/conteo_milan.html" class="navbar-link active">Mi Conteo</a></li>
                <li class="navbar-item"><a href="https://milandroid.dev/eleccioneshn2025/proyeccion-simple.html" class="navbar-link">Análisis a CNE</a></li>
            </ul>
        </div>
    </nav>

    <!-- Disclaimer Modal -->
    <div id="disclaimerModal" class="modal-overlay">
        <div class="modal-content">
            <h2 class="modal-header">Aviso Legal</h2>
            <div class="modal-body">
                <p>Este sitio no pertenece ni está afiliado al Consejo Nacional Electoral (CNE) de Honduras.</p>
                <p>Todas las actas presentadas en esta plataforma son documentos públicos obtenidos de fuentes oficiales del CNE y se comparten únicamente con fines informativos, de transparencia y acceso ciudadano.</p>
                <p>No modificamos, alteramos ni interpretamos el contenido de las actas. El uso, visualización y verificación de la información es responsabilidad exclusiva del usuario.</p>
            </div>
            <div class="modal-footer">
                <button class="modal-btn" onclick="closeDisclaimerModal()">Entendido</button>
            </div>
        </div>
    </div>

    <div class="container">
        <header>
            <div class="controls">
                <div class="control-group">
                    <label class="control-label" for="departamento-select">Departamento</label>
                    <select id="departamento-select">
                        <option value="">TODOS</option>
                    </select>
                </div>

                <div class="control-group">
                    <label class="control-label" for="municipio-select">Municipio</label>
                    <select id="municipio-select" disabled>
                        <option value="">TODOS</option>
                    </select>
                </div>

                <div class="control-group">
                    <label class="control-label" for="centro-select">Centro de Votación</label>
                    <select id="centro-select" disabled>
                        <option value="">TODOS</option>
                    </select>
                </div>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                <label class="dept-details-checkbox-wrapper">
                    <input type="checkbox" id="toggle-dept-details">
                    <span class="dept-details-checkbox-label">Ver detalles por departamento</span>
                </label>
                <label class="dept-details-checkbox-wrapper">
                    <input type="checkbox" id="toggle-other-candidates">
                    <span class="dept-details-checkbox-label">Ver todos los candidatos</span>
                </label>
            </div>
        </header>

        <div id="loading">
            <div class="spinner"></div>
            <p>Cargando resultados...</p>
        </div>

        <div id="error"></div>

        <div id="results" class="main-content">
            <div id="candidates-list" class="candidates-grid">
                <!-- Candidate cards will be dynamically inserted here -->
            </div>
        </div>

        <!-- Actas Information Section -->
        <div id="actas-info" class="actas-info">
            <div id="actas-grid" class="actas-grid">
                <!-- Actas data will be dynamically inserted here -->
            </div>
        </div>

        <!-- Mismatches Section -->
        <div id="mismatches-section" class="actas-info" style="display: none; margin-top: 15px;">
            <h3 class="actas-title">Actas con Diferencias</h3>

            <!-- Filters -->
            <div class="actas-filters">
                <div class="filter-group">
                    <label class="filter-label" for="mismatch-filter-departamento">Departamento</label>
                    <select id="mismatch-filter-departamento" class="filter-select">
                        <option value="">Todos</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label" for="mismatch-filter-municipio">Municipio</label>
                    <select id="mismatch-filter-municipio" class="filter-select">
                        <option value="">Todos</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label" for="mismatch-filter-centro">Centro</label>
                    <input type="text" id="mismatch-filter-centro" class="filter-input" placeholder="Buscar por centro...">
                </div>
                <div class="filter-group">
                    <label class="filter-label" for="mismatch-filter-tipo">Tipo Diferencia</label>
                    <select id="mismatch-filter-tipo" class="filter-select">
                        <option value="">Todos</option>
                        <option value="Sin votos CNE">Sin votos CNE</option>
                        <option value="Diferencia votos">Diferencia votos</option>
                    </select>
                </div>
                <div class="filter-group">
                    <button id="mismatch-clear-filters-btn" class="clear-filters-btn">Limpiar Filtros</button>
                </div>
            </div>

            <div class="actas-list-scroll-wrapper">
                <div id="mismatches-list" style="margin-top: 15px;">
                    <!-- Paginated list will be inserted here -->
                </div>
            </div>

            <div id="mismatches-pagination-controls" style="display: flex; justify-content: center; gap: 10px; margin-top: 15px; flex-wrap: wrap;">
                <!-- Pagination buttons will be inserted here -->
            </div>
        </div>
    </div>

    <script>
        // Political parties mapping (key => full name)
        const PARTIDOS = {
            "DC": "PARTIDO DEMOCRATA CRISTIANO DE HONDURAS",
            "Libre": "PARTIDO LIBERTAD Y REFUNDACION",
            "PINU": "PARTIDO INNOVACION Y UNIDAD SOCIAL DEMOCRATA",
            "PLH": "PARTIDO LIBERAL DE HONDURAS",
            "PNH": "PARTIDO NACIONAL DE HONDURAS"
        };

        // Political party logos (key => logo URL)
        const PARTIDOS_LOGOS = {
            "DC": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADgAAAAlCAMAAAAgENppAAAAYFBMVEUAkjr///8AjCnE3soAiR8AjzH0+vYAkTf7/fwAiBsAgwDf7eIomkwWlUAAji7k8OfT5te11r3M49JwtIG72cJHo2GeyqlirnZYqm0Ahg+EvZF9uYuPwpuoz7I1nVOJv5bjrv9+AAAA1ElEQVRIie2T2w6CMAyGt7IjCoyjBxTe/y1tF8QYkS0m3u2/GCzpl7Z/O8aSkv4krWOiJJAEyOddyGMBEGQh4walmlb4WNEeOOemK2QYXORKJMV67QPkC+ROMBjox/gDwqDKy54KPElNyPkiOvxc91N60DJZYmhmRzxvwDQopeoyBmQCU1b5HcGJTLLWxpSKIDgquUawiJrit4w42v1K33rsfI8z9egaN0T0uLrKFlep5Dns6uYcVYQ5W5tjpoBHH7s6VoTVLLSrP7+OLcW9x6SkOD0AUGQIXuxlVPAAAAAASUVORK5CYII=",
            "Libre": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADgAAAAaCAMAAADVPG8RAAAAdVBMVEX////SAADRAADUAB7TABDuubvOAADTABXhd3z89fXcWmH++vrzzc7UABr33d7fam/jhIjww8T009Tsr7H56OjbVFvrqKvYNkDnlpnyyMr78PDTAArvvr/ifIDXLjngcXfljpLVFCXZRE3WJzDeY2jaTFTpoaOonFvCAAAB1klEQVQ4jZ2U65KDIAyFk6h4oSoi3lBbW23f/xEXqHbqbjuzY350kOY7kJMMAP8N/u/MX1HLg2CUHwTPFB/i4ugyHQKLTtIhsAW4ljslRAEcwxAg9/G7cwaqvfeNAPsIYoYMIPHp9I3jRpKz0w70I4BhCAwY4lfQOXrx8+rWzHODDV/BoigcKDMhAptzkhJka3VKIep1anRbFpmCeB63E81VyYLhQtjTzWwz6muiCTpEItyVULDgddWYPLSgh02FHhoH0fMMMilK+0eLKakXJ9b1DgwXgAemswXTuVO8Cq3RA/bjZlKTvJuzgc4c8ogbkDK39oUQo2+1bChq4RO4JpO2oHFEk+fRM57ZGSs/gli4ZIIVNCKotY453wa8Sj+C4d02K6wc6PJCNEdkeb7dUD4t/esqke9Z81cwoxSTnHomQc+T3TmfN5BRbvpIZuTuxCYyTahdH9mzqNkWmHZG4kp9YPO3nmqlzUTFpghufnQQuHK4ViqTMlNcDoOxrGM1qIrdMkjvn0bSSMhyWprr3NyXyziOUZ4klYB6dl0/zWxsnfW7yMpxSaI2kOr3iyambVUaE5a3f3j3aNsg+/IEivczBL3mT3ZDoT8jLoL9p06Ovndgff0B3VgZey9MDFkAAAAASUVORK5CYII=",
            "PINU": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADgAAAA4CAMAAACfWMssAAAAsVBMVEX/////eRH/eRAAWSn/eRL/dgD/cgD/bwD/bQD/dAAAWCr/+/j/eAr//vz+eAD/ew/+383+xqf+7+b+qnr/6t//9vEAURn+vZj+zbL+iTn+wJ7+lFX+0bj/aAD+2MP+gCT+to7+nGH+pG6bah7+kEjvdxIASADp7uuJpZIAThC4yb6bsqP+hi/+sYbPchdXYCTddBWzbRyoax02XSbFcRgkXChNXyR9ZSGQaB+HZiB8nYiIU9ttAAAE1UlEQVRIiY1Xh3bbOgyVaXNJtLZiDUuKV5K2zujLbP//wx4Aajix0gTnxKItXuISAC8Rx/nMYp8x3/v09YQ1mxU+MjVjeomjZNt8A5ZzKQoceJKZgH7ytdRfQ0PFmIxhsOTMtPSLZEzFX7ssOBMRAn1jjvjDpWB8809IabnCvAoHreF7fB4NUyG9upyEZUVtkdww4RGAFohhr+TZSVQxEeU00N3Ct5rJNTz3nBiWwlJ31orpID0DNhAUQ3mLYcIWnpWmx54bIgCemZHnQFyQadpcxQ0mcNMGCexAGp3QViHKagLnOBEmAnMf1rIawp9uZI1ftoL1MTqzlereRe9i4OXwkeO79dn+upVuIYA66101ed701FIsgsiO86GKlry+taOt0C3NzSuppBDwUeUEbLWiCnaySvk9EEpDtNbpZo9lHRnJ2QyNMS4N1VFh1861ZsIu4cS1gUCrLW0MPuJCmtmJGVlAdOicxHsFc3ltt+NFvoCvmtu9h5LPPhiXlk8JRCCXx/GolBygRmGhNO/ddU4p2AWVwPFdbJcIlRHWx4hj7IRujMVnZHuWkuVK4Ok7jjzZ3WEcc6zzgOUfYRToEHcx8gvud8HoHOmky5Pp4TYfC9DjJ0Qf3PkJ0OgB5YWrfeiUSiizKUNKRiRmCzJ0+OK6b8FIwJ6teH1bSClk6Ww1rMaFFMcUj9Cis1nw253P3YcRiXIQ+kpoSB2eu6PgBodMZY6nWA9kT4ADexgjqzyQTJhoDNcghGVStT44FJz0rAcu/nsEmHv/+wQIwdNSSt7uk5XNyjJL1+Ul6dTg8c56PIxAAbko12E8oTvRAOyZnnIV0VQSPwAXix0h3acxOtNALw5PqWISyZ4Ddkq1CeM+nXGYr5I9nFMbnC7fh47o3H0ZgHhEuBK8rZIyD51ACaFBg1GEIdp2zuH1sQfevw1RhXyJLhuydbYck2i0qEMU765Me6YnXFHOQf8EOmF8C7qBZVPcrlEDV8Linly3Q8KziysJBpRpZaB64EujqlXYpyazm3x4fdu9ItSdv+3+/KHTxWQvf06aJ0HjLMej4qFu0aSAseDwikUO1jmEAhmg7yze7OlSpGmYkYPrjkk0Bhzsi3Mpj7dSq4YuZHQ5W0BK3OfxPGKhNoqrKjyDQULwyscbhAHBxeHJfX44AFOGOKyaIyQDoOO5zxKEgcjRHiJlFk9/Himu8PeyuwuMVf9lQqo6QONa49H0e/0KXy/cIY2AdS92Pb+0FZjEukOCCPRCntNV+PfqYgDOL67+4m+J1f1Lxe21S1SVMFacQylpgesb9+rHBdiPK/fmGjO1lcpKY1pINaRl1S2Rwh7qjvH1z183N79+Xnf0a9CWTvlXq48pSeEeEHgpfeiGcEel/PxCzqB8OXZjWV1EA5usLOgq3+jp1gFmBNAdCASsBMe5UYIByRSn5mHZwrUkJpBey/ttBMag460U2IRU3PZLKfYz/Lyna+B6xULGi84ONppasqhvkKCmzHn/AIETglo3kHNG/Qy0O+h4bMmAwmR4soIiApRsnwotFbWdxdAEVtPnqrNEs66VMmbhUKy+ajvJUI8kxQjC6OMpT7/X6Oa1NoJUIejaTyfguutI/2nprU+tILTWM1uViX/5jc6a6HacZ5bh5P8Q/wOsYVNwa1QE+wAAAABJRU5ErkJggg==",
            "PLH": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADgAAAAlCAMAAAAgENppAAAADFBMVEXYHgX////WAADzzMuQ3qFRAAAAKklEQVRIie3ToQEAAAjDsAH//8wPFVONr9sSqWuhHJSBDA1hiLeK3yF1PfVnBJnWhtatAAAAAElFTkSuQmCC",
            "PNH": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADgAAAAlCAMAAAAgENppAAAAQlBMVEUnDeD///8WAN8lB+CYk+3Jx/U+L+LZ2PiIg+vRz/ZfVeWloO+Tjeyalu1DN+Lv7/y5t/J7dOlOQ+PCwPR9d+lYTeXK9I0CAAAAlElEQVRIie2SSQ7EIAwE023IHrL//6sBZdBsioQ5UydfSnTbVFWh8IBIplfXeSaNYZ7YNFmiCJDVki3Q6p7kTQd0rzHR6wfjGeEZwzT0qeaEL6bkwHTzW5udoii5RG9JbfgTNz1mFO0tWqUojFGp+wNc/Va2ze9oVVa02MPld21W4ggZhQdUIs94PLpTZ/J/KhQ+uACtIwMbD73hOgAAAABJRU5ErkJggg=="
        };

        // Candidates mapping (key => candidate name)
        const CANDIDATOS = {
            "DC": "MARIO ENRIQUE RIVERA CALLEJAS",
            "Libre": "RIXI RAMONA MONCADA GODOY",
            "PINU": "JORGE NELSON AVILA GUTIERREZ",
            "PLH": "SALVADOR ALEJANDRO CESAR NASRALLA SALUM",
            "PNH": "NASRY JUAN ASFURA ZABLAH"
        };

        // Candidates images (key => image URL) - Synced from constants.py
        const CANDIDATOS_IMAGENES = {
            "DC": "https://www.laprensa.hn/binrepository/1260x945/0c0/0d0/none/11004/YJOO/9_12620377_20251116165825.jpg",
            "Libre": "https://upload.wikimedia.org/wikipedia/commons/c/ca/Honduran_Minister_of_Defense_Rixi_Moncada_visits_U.S._Southern_Command_%28cropped%29.jpg",
            "PINU": "https://proceso.hn/wp-content/uploads/2021/02/Nelson-Avila.jpg",
            "PLH": "https://upload.wikimedia.org/wikipedia/commons/5/51/Salvador_Nasralla_2022_%28cropped%29.jpg",
            "PNH": "https://upload.wikimedia.org/wikipedia/commons/b/b7/Nasry_Asfura_in_2020_%28close-up%29.jpg",
        };

        // Department names mapping
        const DEPARTAMENTOS = {
            "01": "ATLANTIDA",
            "06": "CHOLUTECA",
            "02": "COLON",
            "03": "COMAYAGUA",
            "04": "COPAN",
            "05": "CORTES",
            "07": "EL PARAISO",
            "08": "FRANCISCO MORAZAN",
            "09": "GRACIAS A DIOS",
            "10": "INTIBUCA",
            "11": "ISLAS DE LA BAHIA",
            "12": "LA PAZ",
            "13": "LEMPIRA",
            "14": "OCOTEPEQUE",
            "15": "OLANCHO",
            "16": "SANTA BARBARA",
            "17": "VALLE",
            "20": "VOTO EN EL EXTERIOR",
            "18": "YORO"
        };

        // Helper function to get party key from full party name
        function getPartyKey(fullPartyName) {
            for (const [key, name] of Object.entries(PARTIDOS)) {
                if (name === fullPartyName) {
                    return key;
                }
            }
            return null;
        }

        // Political party colors for charts
        const PARTY_COLORS = {
            "DC": "#11992B",
            "Libre": "#DC143C",
            "PINU": "#ffa500",
            "PLH": "#FF0000",
            "PNH": "#1E90FF"
        };

        // Global state
        let processedMetadata = null;
        let municipiosData = null;
        let centrosData = null;
        let currentDepartamento = null;
        let currentMunicipio = null;
        let currentCentro = null;
        let firstCandidateDeptOrder = []; // Store the department order from the first candidate

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            loadProcessedMetadata();
        });

        // Load processed metadata
        async function loadProcessedMetadata() {
            const loadingEl = document.getElementById('loading');
            const errorEl = document.getElementById('error');
            const resultsEl = document.getElementById('results');

            // Show loading state
            loadingEl.style.display = 'flex';
            errorEl.style.display = 'none';
            resultsEl.style.display = 'none';

            try {
                // Load all required data files
                const [metadataResponse, municipiosResponse, centrosResponse] = await Promise.all([
                    fetch('https://milandroid.dev/eleccioneshn2025/reports/processed_metadata.json' + `?${Date.now()}`),
                    fetch('https://milandroid.dev/eleccioneshn2025/reports/municipios_data.json' + `?${Date.now()}`),
                    fetch('https://milandroid.dev/eleccioneshn2025/reports/centros_data.json' + `?${Date.now()}`)
                ]);

                if (!metadataResponse.ok || !municipiosResponse.ok || !centrosResponse.ok) {
                    throw new Error('No se pudo cargar los datos procesados');
                }

                processedMetadata = await metadataResponse.json();
                municipiosData = await municipiosResponse.json();
                centrosData = await centrosResponse.json();

                // Initialize dropdowns
                initializeDepartamentoDropdown();

                // Load initial view (all data)
                displayResults();

                // Hide loading and show results
                loadingEl.style.display = 'none';
                resultsEl.style.display = 'flex';

            } catch (error) {
                console.error('Error loading processed metadata:', error);
                loadingEl.style.display = 'none';
                showError(`Error: ${error.message}`);
            }
        }

        // Initialize departamento dropdown
        function initializeDepartamentoDropdown() {
            const select = document.getElementById('departamento-select');
            const municipioSelect = document.getElementById('municipio-select');
            const centroSelect = document.getElementById('centro-select');

            // Get departamentos from DEPARTAMENTOS constant and sort alphabetically by name
            const sortedDepartamentos = Object.entries(DEPARTAMENTOS)
                .sort((a, b) => a[1].localeCompare(b[1]));

            sortedDepartamentos.forEach(([code, name]) => {
                const option = document.createElement('option');
                option.value = code;
                option.textContent = name;
                select.appendChild(option);
            });

            // Add event listener
            select.addEventListener('change', (e) => {
                currentDepartamento = e.target.value || null;
                currentMunicipio = null;
                currentCentro = null;

                if (currentDepartamento) {
                    // Enable and populate municipio dropdown
                    initializeMunicipioDropdown(currentDepartamento);
                } else {
                    // Disable municipio and centro dropdowns
                    municipioSelect.disabled = true;
                    municipioSelect.innerHTML = '<option value="">TODOS</option>';
                    centroSelect.disabled = true;
                    centroSelect.innerHTML = '<option value="">TODOS</option>';
                }

                // Reload results
                displayResults();
            });
        }

        // Initialize municipio dropdown based on selected departamento
        function initializeMunicipioDropdown(departamentoCode) {
            const select = document.getElementById('municipio-select');
            const centroSelect = document.getElementById('centro-select');

            // Clear and reset
            select.innerHTML = '<option value="">TODOS</option>';
            select.disabled = false;

            // Find departamento in municipiosData by codigo field
            if (municipiosData) {
                let deptData = null;

                // Search for the department with matching codigo
                for (const [deptName, data] of Object.entries(municipiosData)) {
                    if (data.codigo === departamentoCode) {
                        deptData = data;
                        break;
                    }
                }

                if (deptData && deptData.municipios) {
                    const municipios = deptData.municipios;

                    // Sort by municipio name
                    municipios.sort((a, b) => a.municipio.localeCompare(b.municipio));

                    // Populate dropdown
                    municipios.forEach(muni => {
                        const option = document.createElement('option');
                        // Full code is departamento code + municipio id
                        option.value = departamentoCode + muni.id_municipio;
                        option.textContent = muni.municipio;
                        select.appendChild(option);
                    });
                }
            }

            // Reset centro dropdown
            centroSelect.disabled = true;
            centroSelect.innerHTML = '<option value="">TODOS</option>';

            // Add event listener
            select.removeEventListener('change', handleMunicipioChange);
            select.addEventListener('change', handleMunicipioChange);
        }

        // Handle municipio selection change
        function handleMunicipioChange(e) {
            const centroSelect = document.getElementById('centro-select');

            currentMunicipio = e.target.value || null;
            currentCentro = null;

            if (currentMunicipio) {
                // Enable and populate centro dropdown
                initializeCentroDropdown(currentMunicipio);
            } else {
                // Disable centro dropdown
                centroSelect.disabled = true;
                centroSelect.innerHTML = '<option value="">TODOS</option>';
            }

            // Reload results
            displayResults();
        }

        // Initialize centro dropdown based on selected municipio
        function initializeCentroDropdown(municipioCode) {
            const select = document.getElementById('centro-select');

            // Clear and reset
            select.innerHTML = '<option value="">TODOS</option>';
            select.disabled = false;

            // Extract departamento code and municipio id from municipioCode
            const departamentoCode = municipioCode.substring(0, 2);
            const municipioId = municipioCode.substring(2);
            const departamentoName = DEPARTAMENTOS[departamentoCode];

            // Get centros for this municipio from centrosData
            if (centrosData && centrosData[departamentoName]) {
                const deptData = centrosData[departamentoName];
                const municipio = deptData.municipios?.find(m => m.id_municipio === municipioId);

                if (municipio && municipio.zonas) {
                    const allCentros = [];

                    // Collect all centros from all zonas
                    municipio.zonas.forEach(zona => {
                        if (zona.centros) {
                            zona.centros.forEach(centro => {
                                // Full code is dept + municipio + zona + centro
                                const centroCode = departamentoCode + municipioId + zona.id_zona + centro.id_puesto;
                                allCentros.push({
                                    code: centroCode,
                                    name: centro.puesto
                                });
                            });
                        }
                    });

                    // Sort by name
                    allCentros.sort((a, b) => a.name.localeCompare(b.name));

                    // Populate dropdown
                    allCentros.forEach(centro => {
                        const option = document.createElement('option');
                        option.value = centro.code;
                        option.textContent = centro.name;
                        select.appendChild(option);
                    });
                }
            }

            // Add event listener
            select.removeEventListener('change', handleCentroChange);
            select.addEventListener('change', handleCentroChange);
        }

        // Handle centro selection change
        function handleCentroChange(e) {
            currentCentro = e.target.value || null;
            displayResults();
        }

        // Display error message
        function showError(message) {
            const errorEl = document.getElementById('error');
            errorEl.textContent = message;
            errorEl.style.display = 'block';
        }

        // Display the election results
        function displayResults() {
            if (!processedMetadata) return;

            // Reset the department order when loading new results
            firstCandidateDeptOrder = [];

            // Get votes per candidate based on current filters
            const votesPerCandidate = getVotesPerCandidate();

            // Sort candidates by votes (descending)
            const candidatosSorted = Object.entries(votesPerCandidate)
                .map(([party, votes]) => ({
                    parpo_nombre: party,
                    votos: votes,
                    cddto_nombres: CANDIDATOS[getPartyKey(party)] || party
                }))
                .sort((a, b) => b.votos - a.votos);

            // Calculate total votes
            const totalVotos = candidatosSorted.reduce((sum, candidato) => sum + candidato.votos, 0);

            // Display candidates cards
            displayCandidateCards(candidatosSorted, totalVotos);

            // Initialize department toggle button
            initializeDepartmentToggle();

            // Check if the checkbox is checked and re-apply the expanded state
            const toggleCheckbox = document.getElementById('toggle-dept-details');
            const candidatesGrid = document.getElementById('candidates-list');
            const isTwoCandidatesMode = candidatesGrid && candidatesGrid.classList.contains('two-candidates-mode');

            if (toggleCheckbox && toggleCheckbox.checked) {
                applyDepartmentDetailsExpanded();

                // Also reapply split-layout class for two-candidates mode on desktop
                if (isTwoCandidatesMode) {
                    const allCards = document.querySelectorAll('.candidate-card');
                    allCards.forEach(card => {
                        if (!card.classList.contains('hidden-candidate')) {
                            card.classList.add('split-layout');
                        }
                    });
                }
            }

            // Check if "Ver todos los candidatos" checkbox is checked and reapply visibility
            const otherCandidatesCheckbox = document.getElementById('toggle-other-candidates');
            if (otherCandidatesCheckbox && otherCandidatesCheckbox.checked) {
                // Show all candidates
                const hiddenCandidates = document.querySelectorAll('.candidate-card.hidden-candidate');
                hiddenCandidates.forEach(card => {
                    card.style.display = 'flex';
                });
                // Remove centered layout
                candidatesGrid.classList.remove('two-candidates-mode');
                // Remove split layout when showing all candidates
                const allCards = document.querySelectorAll('.candidate-card');
                allCards.forEach(card => {
                    card.classList.remove('split-layout');
                });
            }

            // Load and display actas information from processed metadata
            loadActasFromProcessedMetadata();
        }

        // Helper function to initialize all parties with 0 votes
        function initializeZeroVotes() {
            const votesPerCandidate = {};
            Object.values(PARTIDOS).forEach(party => {
                votesPerCandidate[party] = 0;
            });
            return votesPerCandidate;
        }

        // Get votes per candidate based on current filters
        function getVotesPerCandidate() {
            if (!processedMetadata) {
                console.error('No processedMetadata available');
                return initializeZeroVotes();
            }

            // No filters - use total votes
            if (!currentDepartamento && !currentMunicipio && !currentCentro) {
                const totalVotes = processedMetadata.voting_statistics?.total_votes_per_candidate || initializeZeroVotes();
                return totalVotes;
            }

            // Centro filter - use per_candidate_by_centro
            if (currentCentro) {
                const centroKey = formatCentroKey(currentCentro);
                const centroData = processedMetadata.voting_statistics?.per_candidate_by_centro?.[centroKey];
                return centroData || initializeZeroVotes();
            }

            // Municipio filter - use per_candidate_by_municipio
            if (currentMunicipio) {
                const municipioKey = formatMunicipioKey(currentMunicipio);
                const municipioData = processedMetadata.voting_statistics?.per_candidate_by_municipio?.[municipioKey];
                return municipioData || initializeZeroVotes();
            }

            // Departamento filter only - use per_candidate_by_departamento
            if (currentDepartamento) {
                const deptData = processedMetadata.voting_statistics?.per_candidate_by_departamento?.[currentDepartamento];
                return deptData || initializeZeroVotes();
            }

            return initializeZeroVotes();
        }

        // Calculate votes from per_acta_details with municipio/centro filters
        function calculateVotesFromFilteredActas() {
            const votesPerCandidate = {};

            // Initialize all parties with 0 votes
            Object.values(PARTIDOS).forEach(party => {
                votesPerCandidate[party] = 0;
            });

            if (!processedMetadata.per_acta_details) {
                return votesPerCandidate;
            }

            // Filter and sum votes from actas
            Object.entries(processedMetadata.per_acta_details).forEach(([actaId, acta]) => {
                // Check if acta matches filters
                const deptCode = acta.codigo_departamento || acta.departamento_codigo;
                const muniCode = acta.codigo_municipio || acta.municipio_codigo;
                const centroCode = acta.codigo_centro || acta.centro_codigo;

                // Apply filters
                if (currentDepartamento && deptCode !== currentDepartamento) {
                    return;
                }

                if (currentMunicipio && muniCode !== currentMunicipio) {
                    return;
                }

                if (currentCentro && centroCode !== currentCentro) {
                    return;
                }

                // Only include valid actas
                if (acta.status !== 'correcta') {
                    return;
                }

                // Sum votes
                if (acta.votes_per_candidate) {
                    Object.entries(acta.votes_per_candidate).forEach(([party, votes]) => {
                        if (votesPerCandidate.hasOwnProperty(party)) {
                            votesPerCandidate[party] += votes || 0;
                        }
                    });
                }
            });

            return votesPerCandidate;
        }

        // Helper function to format municipio code with dashes (e.g., "12002" -> "12-002")
        function formatMunicipioKey(municipioCode) {
            if (!municipioCode || municipioCode.length < 5) return municipioCode;
            const deptCode = municipioCode.substring(0, 2);
            const muniCode = municipioCode.substring(2, 5);
            return `${deptCode}-${muniCode}`;
        }

        // Helper function to format centro code with dashes (e.g., "1200202001" -> "12-002-02-001")
        function formatCentroKey(centroCode) {
            if (!centroCode || centroCode.length < 10) return centroCode;
            const deptCode = centroCode.substring(0, 2);
            const muniCode = centroCode.substring(2, 5);
            const zonaCode = centroCode.substring(5, 7);
            const centCode = centroCode.substring(7, 10);
            return `${deptCode}-${muniCode}-${zonaCode}-${centCode}`;
        }

        // Load and display actas information from processed metadata
        async function loadActasFromProcessedMetadata() {
            try {
                if (!processedMetadata) {
                    console.error('No processed metadata available');
                    hideActasInfo();
                    return;
                }

                let stats = null;

                // Check filters and get appropriate stats
                if (currentCentro) {
                    // Centro selected - use actas_statistics_by_centro
                    const centroKey = formatCentroKey(currentCentro);
                    stats = processedMetadata.actas_statistics_by_centro?.[centroKey];
                } else if (currentMunicipio) {
                    // Municipio selected - use actas_statistics_by_municipio
                    const municipioKey = formatMunicipioKey(currentMunicipio);
                    stats = processedMetadata.actas_statistics_by_municipio?.[municipioKey];
                } else if (currentDepartamento) {
                    // Departamento selected - use actas_statistics_by_departamento
                    stats = processedMetadata.actas_statistics_by_departamento?.[currentDepartamento];
                } else {
                    // No filters - use global stats
                    stats = processedMetadata.actas_statistics_calculated;
                }

                // If no stats found, show zeros
                if (!stats) {
                    stats = {
                        total: 0,
                        correctas: 0,
                        inconsistencias: 0,
                        expected_total: 0
                    };
                }

                // Create actas object in the format expected by displayActasInfo
                const actasData = {
                    total: stats.total || 0,
                    publicadas: stats.total || 0, // Using total as publicadas
                    espera: stats.expected_total ? (stats.expected_total - stats.total) : 0,
                    correctas: stats.correctas || 0,
                    inconsistencias: stats.inconsistencias || 0,
                    expected_total: stats.expected_total || 19167 // 19167 is the total of actas that exists on the election process
                };

                displayActasInfo(actasData);
            } catch (error) {
                console.error('Error loading actas from processed metadata:', error);
                hideActasInfo();
            }
        }

        // Display actas information
        // Get total votes for current selection
        function getTotalVotesForCurrentSelection() {
            if (!processedMetadata || !processedMetadata.voting_statistics) {
                return null;
            }

            const votingStats = processedMetadata.voting_statistics;

            // Priority: Centro > Municipio > Departamento > General
            if (currentCentro) {
                // Centro selected
                const centroData = votingStats.total_votes_per_centro?.[currentCentro];
                return centroData?.total_votes || null;
            } else if (currentMunicipio) {
                // Municipio selected
                const municipioData = votingStats.total_votes_per_municipio?.[currentMunicipio];
                return municipioData?.total_votes || null;
            } else if (currentDepartamento) {
                // Departamento selected
                const deptData = votingStats.total_votes_per_departamento?.[currentDepartamento];
                return deptData?.total_votes || null;
            } else {
                // General - show total votes
                return votingStats.total_votes || null;
            }
        }

        function displayActasInfo(actas) {
            const actasContainer = document.getElementById('actas-info');
            const actasGrid = document.getElementById('actas-grid');

            // Clear previous content
            actasGrid.innerHTML = '';

            // Use expected_total from actas or fall back to total
            const expectedTotal = actas.expected_total || actas.total;
            const espera = actas.espera || (expectedTotal - actas.total);

            // Get total votes for current selection
            const totalVotes = getTotalVotesForCurrentSelection();

            // Define the actas items to display
            const actasItems = [
                {
                    label: 'En Espera',
                    value: espera,
                    percentage: expectedTotal > 0 ? ((espera / expectedTotal) * 100).toFixed(2) : '0.00'
                },
                {
                    label: 'Procesadas',
                    value: actas.total,
                    percentage: expectedTotal > 0 ? ((actas.total / expectedTotal) * 100).toFixed(2) : '0.00'
                },
                {
                    label: 'Usadas',
                    value: actas.total - actas.inconsistencias,
                    percentage: actas.total > 0 ? (((actas.total - actas.inconsistencias) / actas.total) * 100).toFixed(2) : '0.00'
                },
                {
                    label: 'Correctas',
                    value: actas.correctas,
                    percentage: actas.total > 0 ? ((actas.correctas / actas.total) * 100).toFixed(2) : '0.00'
                },
                {
                    label: 'Inconsistencias',
                    value: actas.inconsistencias,
                    percentage: actas.total > 0 ? ((actas.inconsistencias / actas.total) * 100).toFixed(2) : '0.00'
                },
            ];

            // Add total votes item if available
            if (totalVotes !== null) {
                actasItems.push({
                    label: 'Votos (Incluye nulos)',
                    value: totalVotes,
                    percentage: null  // No percentage for total votes
                });
            }

            // Create and append actas items
            actasItems.forEach(item => {
                const actasItem = createActasItem(item.label, item.value, item.percentage);
                actasGrid.appendChild(actasItem);
            });

            // Show the actas container
            actasContainer.classList.add('visible');
        }

        // Hide actas information section
        function hideActasInfo() {
            const actasContainer = document.getElementById('actas-info');
            actasContainer.classList.remove('visible');
        }

        // Create an actas item element
        function createActasItem(label, value, percentage = null) {
            const item = document.createElement('div');
            item.className = 'actas-item';

            const labelEl = document.createElement('div');
            labelEl.className = 'actas-item-label';
            labelEl.textContent = label;
            item.appendChild(labelEl);

            const valueEl = document.createElement('div');
            valueEl.className = 'actas-item-value';
            valueEl.textContent = (value || 0).toLocaleString('es-HN');
            valueEl.style.display = 'flex';
            valueEl.style.alignItems = 'center';
            valueEl.style.justifyContent = 'space-between';
            valueEl.style.width = '100%';
            valueEl.style.flexWrap = "wrap";

            if (percentage !== null && percentage !== undefined) {
                const percentageEl = document.createElement('div');
                percentageEl.className = 'actas-item-percentage';
                percentageEl.textContent = `${percentage}%`;
                valueEl.appendChild(percentageEl);
            }

            item.appendChild(valueEl);

            return item;
        }

        // Display candidate cards
        function displayCandidateCards(candidatos, totalVotos) {
            const container = document.getElementById('candidates-list');
            container.innerHTML = '';

            candidatos.forEach((candidato, index) => {
                const percentage = totalVotos > 0 ? ((candidato.votos / totalVotos) * 100).toFixed(2) : 0;
                const partyKey = getPartyKey(candidato.parpo_nombre);
                const voteDifference = index === 0 ? candidatos[0].votos - candidatos[1].votos: candidato.votos - candidatos[0].votos;

                // Pass vote difference and position to determine if should be hidden
                const card = createCandidateCard(candidato, percentage, index + 1, partyKey, voteDifference, index >= 2);
                container.appendChild(card);
            });

            // Initialize the other candidates toggle
            initializeOtherCandidatesToggle();
        }

        // Create a candidate card element
        function createCandidateCard(candidato, percentage, position, partyKey, voteDifference = null, shouldBeHidden = false) {
            const card = document.createElement('div');
            card.className = 'candidate-card';

            // Add hidden class to candidates beyond top 2
            if (shouldBeHidden) {
                card.classList.add('hidden-candidate');
            }

            // Image wrapper with rank badge
            const imageWrapper = document.createElement('div');
            imageWrapper.className = 'candidate-image-wrapper';

            // Rank badge
            const rankBadge = document.createElement('div');
            rankBadge.className = `rank-badge rank-${Math.min(position, 3)}`;
            rankBadge.textContent = position;
            imageWrapper.appendChild(rankBadge);

            // Candidate image
            const img = document.createElement('img');
            img.className = 'candidate-image';
            img.src = partyKey && CANDIDATOS_IMAGENES[partyKey] ? CANDIDATOS_IMAGENES[partyKey] : 'https://via.placeholder.com/300?text=No+Image';
            img.alt = candidato.cddto_nombres;
            img.onerror = function() {
                this.src = 'https://via.placeholder.com/300?text=No+Image';
            };
            imageWrapper.appendChild(img);

            // Create main content wrapper for split layout
            const mainContent = document.createElement('div');
            mainContent.className = 'card-main-content';
            mainContent.appendChild(imageWrapper);

            // Candidate info section
            const info = document.createElement('div');
            info.className = 'candidate-info';

            // Candidate name
            const name = document.createElement('div');
            name.className = 'candidate-name';
            name.textContent = candidato.cddto_nombres;
            info.appendChild(name);

            // Party section with flag and name
            const partySection = document.createElement('div');
            partySection.className = 'party-section';

            if (partyKey && PARTIDOS_LOGOS[partyKey]) {
                const partyFlag = document.createElement('img');
                partyFlag.className = 'party-flag';
                partyFlag.src = PARTIDOS_LOGOS[partyKey];
                partyFlag.alt = candidato.parpo_nombre;
                partyFlag.onerror = function() {
                    this.style.display = 'none';
                };
                partySection.appendChild(partyFlag);
            }

            const partyName = document.createElement('div');
            partyName.className = 'party-name';
            partyName.textContent = candidato.parpo_nombre;
            partySection.appendChild(partyName);

            info.appendChild(partySection);

            // Stats section with votes and percentage
            const statsSection = document.createElement('div');
            statsSection.className = 'stats-section';

            const votes = document.createElement('div');
            votes.className = 'votes';
            votes.textContent = (candidato.votos || 0).toLocaleString('es-HN');
            statsSection.appendChild(votes);

            const percentageDiv = document.createElement('div');
            percentageDiv.className = 'percentage';
            percentageDiv.textContent = `${percentage}%`;
            statsSection.appendChild(percentageDiv);

            info.appendChild(statsSection);

            // Add vote difference section for all candidates
            if (voteDifference !== null) {
                const diffSection = document.createElement('div');
                let classes = 'vote-difference';
                if (voteDifference < 0) {
                    classes += ' negative';
                }
                if (voteDifference > -50000 && voteDifference < 0) {
                    classes += ' warning';
                }
                diffSection.className = classes;

                const diffLabel = document.createElement('span');
                diffLabel.className = 'vote-difference-label';
                diffLabel.textContent = 'Diferencia:';
                diffSection.appendChild(diffLabel);

                const diffValue = document.createElement('span');
                diffValue.className = 'vote-difference-value';
                diffValue.textContent = `${voteDifference > 0 ? '+' : ''}${voteDifference.toLocaleString('es-HN')}`;
                diffSection.appendChild(diffValue);

                info.appendChild(diffSection);
            }

            // Append info to main content
            mainContent.appendChild(info);

            // Add department differences content section (hidden by default)
            const deptContent = document.createElement('div');
            deptContent.className = 'dept-differences-content';
            deptContent.innerHTML = '<div class="dept-differences-list" data-party="' + partyKey + '"></div>';

            // Append both main content and dept content to card
            card.appendChild(mainContent);
            card.appendChild(deptContent);

            return card;
        }

        // Function to load department differences for a specific party (from processed metadata)
        async function loadDepartmentDifferences(partyKey, containerElement, isFirstCandidate = false) {
            containerElement.innerHTML = '<div style="text-align: center; padding: 10px; color: var(--text-secondary);">Cargando...</div>';

            try {
                const partyName = PARTIDOS[partyKey];
                if (!partyName || !processedMetadata || !processedMetadata.voting_statistics?.per_candidate_by_departamento) {
                    containerElement.innerHTML = '<div style="text-align: center; padding: 10px; color: var(--text-secondary);">No hay datos disponibles</div>';
                    return;
                }

                const deptData = processedMetadata.voting_statistics.per_candidate_by_departamento;
                const departmentDifferences = [];

                // Calculate differences for ALL departments (from DEPARTAMENTOS constant)
                Object.entries(DEPARTAMENTOS).forEach(([deptCode, deptName]) => {
                    const candidates = deptData?.[deptCode] || {};

                    // Get all candidates' votes in this department (or 0 if no data)
                    const votesInDept = Object.entries(candidates).length > 0
                        ? Object.entries(candidates)
                            .map(([party, votes]) => ({ party, votes }))
                            .sort((a, b) => b.votes - a.votes)
                        : [];

                    const firstPlace = votesInDept[0];
                    const secondPlace = votesInDept[1];
                    const candidateVotes = candidates[partyName] || 0;

                    let difference;
                    // Check if this candidate is in first place
                    if (votesInDept.length > 0 && candidateVotes === firstPlace.votes) {
                        // First place: compare with second place
                        difference = candidateVotes - (secondPlace ? secondPlace.votes : 0);
                    } else if (firstPlace) {
                        // Not first place: compare with first place
                        difference = candidateVotes - firstPlace.votes;
                    } else {
                        // No data: difference is 0
                        difference = 0;
                    }

                    // Calculate percentage as correctas/expected_total from actas_statistics_by_departamento
                    const deptStats = processedMetadata.actas_statistics_by_departamento?.[deptCode];
                    const correctas = deptStats?.correctas || 0;
                    const expectedTotal = deptStats?.expected_total || 1;
                    const percentageValid = ((correctas / expectedTotal) * 100).toFixed(2);

                    departmentDifferences.push({
                        department: deptName,
                        difference: difference,
                        actasPercentage: percentageValid
                    });
                });

                // Sort by difference (most positive first, then negative)
                departmentDifferences.sort((a, b) => b.difference - a.difference);

                // If this is the first candidate, store the order
                if (isFirstCandidate) {
                    firstCandidateDeptOrder = departmentDifferences.map(item => item.department);
                } else if (firstCandidateDeptOrder.length > 0) {
                    // Sort according to first candidate's order
                    departmentDifferences.sort((a, b) => {
                        const indexA = firstCandidateDeptOrder.indexOf(a.department);
                        const indexB = firstCandidateDeptOrder.indexOf(b.department);
                        return indexA - indexB;
                    });
                }

                // Display the results
                if (departmentDifferences.length === 0) {
                    containerElement.innerHTML = '<div style="text-align: center; padding: 10px; color: var(--text-secondary);">No hay diferencias disponibles</div>';
                    return;
                }

                containerElement.innerHTML = '';
                departmentDifferences.forEach(item => {
                    const diffItem = document.createElement('div');
                    let classes = 'dept-difference-item';

                    // Apply color classes based on difference
                    if (item.difference < -20000) {
                        classes += ' negative';
                    } else if (item.difference < 0) {
                        classes += ' warning';
                    }

                    diffItem.className = classes;

                    const deptName = document.createElement('div');
                    deptName.className = 'dept-difference-name';
                    deptName.textContent = item.department;

                    const actasPercent = document.createElement('div');
                    actasPercent.className = 'dept-difference-percentage';
                    actasPercent.textContent = `${item.actasPercentage}%`;

                    diffItem.appendChild(deptName);
                    diffItem.appendChild(actasPercent);

                    // Right side: vote difference
                    const deptValue = document.createElement('span');
                    deptValue.className = 'dept-difference-value';
                    deptValue.textContent = `${item.difference > 0 ? '+' : ''}${item.difference.toLocaleString('es-HN')}`;

                    diffItem.appendChild(deptValue);

                    containerElement.appendChild(diffItem);
                });

            } catch (error) {
                console.error('Error loading department differences:', error);
                containerElement.innerHTML = '<div style="text-align: center; padding: 10px; color: #dc3545;">Error al cargar datos</div>';
            }
        }

        // Global toggle for department details
        let departmentToggleInitialized = false;

        // Function to expand all department details and load data
        async function applyDepartmentDetailsExpanded() {
            const allContents = document.querySelectorAll('.dept-differences-content');

            // Load first candidate's data first to establish the order
            for (let index = 0; index < allContents.length; index++) {
                const content = allContents[index];
                content.classList.add('expanded');
                const list = content.querySelector('.dept-differences-list');
                const partyKey = list.getAttribute('data-party');
                if (partyKey && list.children.length === 0) {
                    // Only load if not already loaded
                    // Pass isFirstCandidate=true for the first candidate (index 0)
                    await loadDepartmentDifferences(partyKey, list, index === 0);
                }
            }
        }

        function initializeDepartmentToggle() {
            if (departmentToggleInitialized) return;

            const toggleCheckbox = document.getElementById('toggle-dept-details');
            if (!toggleCheckbox) return;

            toggleCheckbox.addEventListener('change', async () => {
                const candidatesGrid = document.getElementById('candidates-list');
                const isTwoCandidatesMode = candidatesGrid && candidatesGrid.classList.contains('two-candidates-mode');

                if (toggleCheckbox.checked) {
                    // Expand all department details
                    applyDepartmentDetailsExpanded();

                    // Add split layout class to cards in two-candidates mode on desktop
                    if (isTwoCandidatesMode) {
                        const allCards = document.querySelectorAll('.candidate-card');
                        allCards.forEach(card => {
                            if (!card.classList.contains('hidden-candidate')) {
                                card.classList.add('split-layout');
                            }
                        });
                    }
                } else {
                    // Collapse all department details
                    const allContents = document.querySelectorAll('.dept-differences-content');
                    allContents.forEach(content => {
                        content.classList.remove('expanded');
                    });

                    // Remove split layout class
                    const allCards = document.querySelectorAll('.candidate-card');
                    allCards.forEach(card => {
                        card.classList.remove('split-layout');
                    });
                }
            });

            departmentToggleInitialized = true;
        }

        // Global toggle for other candidates
        let otherCandidatesToggleInitialized = false;

        // Function to initialize the other candidates toggle
        function initializeOtherCandidatesToggle() {
            if (otherCandidatesToggleInitialized) return;

            const toggleCheckbox = document.getElementById('toggle-other-candidates');
            if (!toggleCheckbox) return;

            const candidatesGrid = document.getElementById('candidates-list');

            toggleCheckbox.addEventListener('change', () => {
                const hiddenCandidates = document.querySelectorAll('.candidate-card.hidden-candidate');
                const deptToggle = document.getElementById('toggle-dept-details');
                const isDeptDetailsExpanded = deptToggle && deptToggle.checked;

                if (toggleCheckbox.checked) {
                    // Show all candidates
                    hiddenCandidates.forEach(card => {
                        card.style.display = 'flex';
                    });
                    // Remove centered layout
                    candidatesGrid.classList.remove('two-candidates-mode');

                    // Remove split layout when showing all candidates
                    const allCards = document.querySelectorAll('.candidate-card');
                    allCards.forEach(card => {
                        card.classList.remove('split-layout');
                    });
                } else {
                    // Hide other candidates (beyond top 2)
                    hiddenCandidates.forEach(card => {
                        card.style.display = 'none';
                    });
                    // Add centered layout for 2 candidates
                    candidatesGrid.classList.add('two-candidates-mode');

                    // Add split layout if department details are expanded
                    if (isDeptDetailsExpanded) {
                        const allCards = document.querySelectorAll('.candidate-card');
                        allCards.forEach(card => {
                            if (!card.classList.contains('hidden-candidate')) {
                                card.classList.add('split-layout');
                            }
                        });
                    }
                }
            });

            // Set initial state (centered for 2 candidates)
            candidatesGrid.classList.add('two-candidates-mode');

            otherCandidatesToggleInitialized = true;
        }

        // Disclaimer Modal Functions
        function showDisclaimerModal() {
            const modal = document.getElementById('disclaimerModal');
            modal.classList.add('active');
        }

        function closeDisclaimerModal() {
            const modal = document.getElementById('disclaimerModal');
            modal.classList.remove('active');
            localStorage.setItem('disclaimerSeen', 'true');
        }

        function checkDisclaimerStatus() {
            const disclaimerSeen = localStorage.getItem('disclaimerSeen');
            if (!disclaimerSeen) {
                showDisclaimerModal();
            }
        }

        // Navbar mobile menu toggle
        function toggleMenu() {
            const menu = document.getElementById('navbarMenu');
            menu.classList.toggle('active');
        }

        // Close menu when clicking outside on mobile
        document.addEventListener('click', function(event) {
            const navbar = document.querySelector('.navbar');
            const menu = document.getElementById('navbarMenu');
            const toggle = document.querySelector('.navbar-toggle');

            if (!navbar.contains(event.target) && menu.classList.contains('active')) {
                menu.classList.remove('active');
            }
        });

        // Check disclaimer status on page load
        checkDisclaimerStatus();

        // ============================================
        // MISMATCHES SECTION
        // ============================================

        // Global state for mismatches
        let mismatchesData = null;
        let csvMappingData = null;
        let currentMismatchPage = 1;
        const mismatchItemsPerPage = 20;

        // Load mismatches data when page loads
        async function loadMismatchesData() {
            try {
                // Load vote_comparison_report.json
                const reportResponse = await fetch('https://milandroid.dev/eleccioneshn2025/reports/vote_comparison_report.json' + `?${Date.now()}`);
                if (!reportResponse.ok) {
                    throw new Error('Could not load vote comparison report');
                }
                const reportData = await reportResponse.json();

                // Load cne_mesas_output.csv
                const csvResponse = await fetch('https://milandroid.dev/eleccioneshn2025/reports/cne_mesas_output.csv' + `?${Date.now()}`);
                if (!csvResponse.ok) {
                    throw new Error('Could not load CSV data');
                }
                const csvText = await csvResponse.text();

                // Parse CSV
                csvMappingData = parseCSV(csvText);

                // Process the mismatches data
                const mismatchesList = [];

                // Get all unique actas from both arrays
                const allActas = [...new Set([
                    ...reportData.actas_with_mismatches,
                    ...reportData.actas_with_other_mismatches
                ])];

                // Process each acta and determine tipo
                allActas.forEach(actaNumber => {
                    const locationInfo = getLocationFromActa(actaNumber);
                    if (locationInfo) {
                        // Check if acta is in actas_with_other_mismatches
                        const isInOtherMismatches = reportData.actas_with_other_mismatches.includes(actaNumber);

                        mismatchesList.push({
                            actaNumber: actaNumber,
                            departamento: locationInfo.departamento,
                            municipio: locationInfo.municipio,
                            centro: locationInfo.centro,
                            tipoDiferencia: isInOtherMismatches ? 'Diferencia votos' : 'Sin votos CNE',
                            pdfUrl: `https://storage.googleapis.com/actas_elecciones_hn2025/actas/${actaNumber}.pdf`
                        });
                    }
                });

                mismatchesData = {
                    mismatchesList: mismatchesList,
                    total: mismatchesList.length
                };

                // Initialize filters
                initializeMismatchesFilters();

                // Display the data
                displayMismatchesList(mismatchesData, currentMismatchPage);

                // Show the section
                const section = document.getElementById('mismatches-section');
                if (section) {
                    section.style.display = 'block';
                }

            } catch (error) {
                console.error('Error loading mismatches data:', error);
            }
        }

        // Parse CSV data
        function parseCSV(csvText) {
            const lines = csvText.split('\n');
            const mapping = {};

            // Skip header line
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;

                // Split by comma, but be careful with commas inside quotes
                const parts = line.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g);
                if (parts && parts.length >= 4) {
                    const departamento = parts[0].replace(/"/g, '').trim();
                    const municipio = parts[1].replace(/"/g, '').trim();
                    const centro = parts[2].replace(/"/g, '').trim();
                    const actaNumber = parts[3].replace(/"/g, '').trim();

                    mapping[actaNumber] = {
                        departamento: departamento,
                        municipio: municipio,
                        centro: centro
                    };
                }
            }

            return mapping;
        }

        // Get location information from acta number
        function getLocationFromActa(actaNumber) {
            if (csvMappingData && csvMappingData[actaNumber]) {
                return csvMappingData[actaNumber];
            }
            return null;
        }

        // Load vote data for an acta from both sources
        async function loadActaVotes(actaNumber) {
            try {
                // Load transformed data
                const transformedResponse = await fetch(`https://milandroid.dev/eleccioneshn2025/reports/actas_data_transformed/${actaNumber}.json`);
                const transformedData = transformedResponse.ok ? await transformedResponse.json() : null;

                // Load CNE data
                const cneResponse = await fetch(`https://milandroid.dev/eleccioneshn2025/reports/actas_data_cne/${actaNumber}.json`);
                const cneData = cneResponse.ok ? await cneResponse.json() : null;

                // Extract party votes
                const votes = {
                    DC: { transformed: 0, cne: 0 },
                    Libre: { transformed: 0, cne: 0 },
                    PINU: { transformed: 0, cne: 0 },
                    PLH: { transformed: 0, cne: 0 },
                    PNH: { transformed: 0, cne: 0 }
                };

                // Get transformed votes
                if (transformedData) {
                    votes.DC.transformed = parseInt(transformedData.partido_dc?.n || '0');
                    votes.Libre.transformed = parseInt(transformedData.partido_libre?.n || '0');
                    votes.PINU.transformed = parseInt(transformedData.partido_pinu?.n || '0');
                    votes.PLH.transformed = parseInt(transformedData.partido_plh?.n || '0');
                    votes.PNH.transformed = parseInt(transformedData.partido_pnh?.n || '0');
                }

                // Get CNE votes
                if (cneData && Array.isArray(cneData)) {
                    cneData.forEach(party => {
                        const partyKey = getPartyKey(party.parpo_nombre);
                        if (partyKey && votes[partyKey]) {
                            votes[partyKey].cne = party.votos || 0;
                        }
                    });
                }

                return votes;
            } catch (error) {
                console.error(`Error loading votes for acta ${actaNumber}:`, error);
                return null;
            }
        }

        // Initialize mismatches filters
        function initializeMismatchesFilters() {
            if (!mismatchesData) return;

            // Get unique departamentos and municipios
            const departamentos = [...new Set(mismatchesData.mismatchesList.map(item => item.departamento))].sort();

            // Populate departamento filter
            const deptSelect = document.getElementById('mismatch-filter-departamento');
            if (deptSelect) {
                deptSelect.innerHTML = '<option value="">Todos</option>';
                departamentos.forEach(dept => {
                    const option = document.createElement('option');
                    option.value = dept;
                    option.textContent = dept;
                    deptSelect.appendChild(option);
                });

                // Add event listener
                deptSelect.addEventListener('change', () => {
                    updateMismatchMunicipioFilter();
                    applyMismatchFilters();
                });
            }

            // Add event listener for municipio filter
            const munSelect = document.getElementById('mismatch-filter-municipio');
            if (munSelect) {
                munSelect.addEventListener('change', applyMismatchFilters);
            }

            // Add event listener for centro filter
            const centroInput = document.getElementById('mismatch-filter-centro');
            if (centroInput) {
                centroInput.addEventListener('input', applyMismatchFilters);
            }

            // Add event listener for tipo filter
            const tipoSelect = document.getElementById('mismatch-filter-tipo');
            if (tipoSelect) {
                tipoSelect.addEventListener('change', applyMismatchFilters);
            }

            // Add event listener for clear button
            const clearBtn = document.getElementById('mismatch-clear-filters-btn');
            if (clearBtn) {
                clearBtn.addEventListener('click', () => {
                    document.getElementById('mismatch-filter-departamento').value = '';
                    document.getElementById('mismatch-filter-municipio').value = '';
                    document.getElementById('mismatch-filter-centro').value = '';
                    document.getElementById('mismatch-filter-tipo').value = '';
                    updateMismatchMunicipioFilter();
                    applyMismatchFilters();
                });
            }
        }

        // Update municipio filter based on selected departamento
        function updateMismatchMunicipioFilter() {
            const selectedDept = document.getElementById('mismatch-filter-departamento').value;
            const munSelect = document.getElementById('mismatch-filter-municipio');

            if (!munSelect || !mismatchesData) return;

            // Get municipios for selected departamento
            let municipios;
            if (selectedDept === '') {
                municipios = [...new Set(mismatchesData.mismatchesList.map(item => item.municipio))];
            } else {
                municipios = [...new Set(
                    mismatchesData.mismatchesList
                        .filter(item => item.departamento === selectedDept)
                        .map(item => item.municipio)
                )];
            }

            municipios.sort();

            // Populate municipio dropdown
            munSelect.innerHTML = '<option value="">Todos</option>';
            municipios.forEach(mun => {
                const option = document.createElement('option');
                option.value = mun;
                option.textContent = mun;
                munSelect.appendChild(option);
            });
        }

        // Apply filters to mismatches list
        function applyMismatchFilters() {
            if (!mismatchesData) return;

            const selectedDept = document.getElementById('mismatch-filter-departamento').value;
            const selectedMun = document.getElementById('mismatch-filter-municipio').value;
            const centroSearch = document.getElementById('mismatch-filter-centro').value.toLowerCase().trim();
            const selectedTipo = document.getElementById('mismatch-filter-tipo').value;

            // Filter the mismatches list
            let filteredList = mismatchesData.mismatchesList;

            if (selectedDept) {
                filteredList = filteredList.filter(item => item.departamento === selectedDept);
            }

            if (selectedMun) {
                filteredList = filteredList.filter(item => item.municipio === selectedMun);
            }

            if (centroSearch) {
                filteredList = filteredList.filter(item =>
                    item.centro.toLowerCase().includes(centroSearch)
                );
            }

            if (selectedTipo) {
                filteredList = filteredList.filter(item => item.tipoDiferencia === selectedTipo);
            }

            // Create filtered data object
            const filteredData = {
                mismatchesList: filteredList,
                total: filteredList.length
            };

            // Reset to page 1
            currentMismatchPage = 1;

            // Display filtered results
            displayMismatchesList(filteredData, currentMismatchPage);
        }

        // Display mismatches list with pagination
        async function displayMismatchesList(data, page = 1) {
            const listContainer = document.getElementById('mismatches-list');
            if (!listContainer || !data) return;

            listContainer.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">Cargando datos...</div>';

            if (data.mismatchesList.length === 0) {
                listContainer.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">No se encontraron actas con diferencias</div>';
                // Hide pagination
                const controlsContainer = document.getElementById('mismatches-pagination-controls');
                if (controlsContainer) {
                    controlsContainer.innerHTML = '';
                }
                return;
            }

            // Calculate pagination
            const startIndex = (page - 1) * mismatchItemsPerPage;
            const endIndex = startIndex + mismatchItemsPerPage;
            const pageItems = data.mismatchesList.slice(startIndex, endIndex);

            // Load vote data for all items on this page
            const itemsWithVotes = await Promise.all(
                pageItems.map(async item => {
                    const votes = await loadActaVotes(item.actaNumber);
                    return { ...item, votes };
                })
            );

            // Clear loading message
            listContainer.innerHTML = '';

            // Create header
            const header = document.createElement('div');
            header.className = 'acta-list-header';
            header.innerHTML = `
                <div>Departamento</div>
                <div>Municipio</div>
                <div>Centro</div>
                <div>JRV</div>
                <div>Tipo Diferencia</div>
                <div>DC</div>
                <div>Libre</div>
                <div>PINU</div>
                <div>PLH</div>
                <div>PNH</div>
                <div>Ver</div>
            `;
            listContainer.appendChild(header);

            // Create list items
            itemsWithVotes.forEach(item => {
                const listItem = document.createElement('div');
                listItem.className = 'acta-list-item';

                // Format vote cells
                const formatVote = (party) => {
                    if (!item.votes) return '-';
                    return `<span style="color: darkolivegreen; cursor: pointer" title="Votos AI">${item.votes[party].transformed}<span>/<b style="color: red; cursor: pointer" title="Votos CNE">${item.votes[party].cne}</b>`;
                };

                listItem.innerHTML = `
                    <div data-label="Departamento: ">${item.departamento}</div>
                    <div data-label="Municipio: ">${item.municipio}</div>
                    <div data-label="Centro: ">${item.centro}</div>
                    <div data-label="Acta: ">${item.actaNumber}</div>
                    <div data-label="Tipo: ">${item.tipoDiferencia}</div>
                    <div data-label="DC: ">${formatVote('DC')}</div>
                    <div data-label="Libre: ">${formatVote('Libre')}</div>
                    <div data-label="PINU: ">${formatVote('PINU')}</div>
                    <div data-label="PLH: ">${formatVote('PLH')}</div>
                    <div data-label="PNH: ">${formatVote('PNH')}</div>
                    <div data-label=""><a href="${item.pdfUrl}" target="_blank" class="acta-link">Ver PDF</a></div>
                `;
                listContainer.appendChild(listItem);
            });

            // Update pagination controls
            displayMismatchPaginationControls(data, page);
        }

        // Display pagination controls for mismatches
        function displayMismatchPaginationControls(data, currentPage) {
            const controlsContainer = document.getElementById('mismatches-pagination-controls');
            if (!controlsContainer) return;

            controlsContainer.innerHTML = '';

            const totalPages = Math.ceil(data.mismatchesList.length / mismatchItemsPerPage);

            if (totalPages <= 1) {
                return; // No pagination needed
            }

            // Previous button
            const prevBtn = document.createElement('button');
            prevBtn.className = 'pagination-btn';
            prevBtn.textContent = 'Anterior';
            prevBtn.disabled = currentPage === 1;
            prevBtn.onclick = () => {
                if (currentPage > 1) {
                    currentMismatchPage = currentPage - 1;
                    displayMismatchesList(data, currentMismatchPage);
                }
            };
            controlsContainer.appendChild(prevBtn);

            // Page numbers (show max 7 buttons)
            const maxButtons = 7;
            let startPage = Math.max(1, currentPage - Math.floor(maxButtons / 2));
            let endPage = Math.min(totalPages, startPage + maxButtons - 1);

            // Adjust if we're near the end
            if (endPage - startPage < maxButtons - 1) {
                startPage = Math.max(1, endPage - maxButtons + 1);
            }

            // First page button (if not in range)
            if (startPage > 1) {
                const firstBtn = document.createElement('button');
                firstBtn.className = 'pagination-btn';
                firstBtn.textContent = '1';
                firstBtn.onclick = () => {
                    currentMismatchPage = 1;
                    displayMismatchesList(data, currentMismatchPage);
                };
                controlsContainer.appendChild(firstBtn);

                if (startPage > 2) {
                    const ellipsis = document.createElement('span');
                    ellipsis.textContent = '...';
                    ellipsis.style.padding = '0 8px';
                    ellipsis.style.color = 'var(--text-secondary)';
                    controlsContainer.appendChild(ellipsis);
                }
            }

            // Page number buttons
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = 'pagination-btn';
                if (i === currentPage) {
                    pageBtn.classList.add('active');
                }
                pageBtn.textContent = i;
                pageBtn.onclick = () => {
                    currentMismatchPage = i;
                    displayMismatchesList(data, currentMismatchPage);
                };
                controlsContainer.appendChild(pageBtn);
            }

            // Last page button (if not in range)
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    const ellipsis = document.createElement('span');
                    ellipsis.textContent = '...';
                    ellipsis.style.padding = '0 8px';
                    ellipsis.style.color = 'var(--text-secondary)';
                    controlsContainer.appendChild(ellipsis);
                }

                const lastBtn = document.createElement('button');
                lastBtn.className = 'pagination-btn';
                lastBtn.textContent = totalPages;
                lastBtn.onclick = () => {
                    currentMismatchPage = totalPages;
                    displayMismatchesList(data, currentMismatchPage);
                };
                controlsContainer.appendChild(lastBtn);
            }

            // Next button
            const nextBtn = document.createElement('button');
            nextBtn.className = 'pagination-btn';
            nextBtn.textContent = 'Siguiente';
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.onclick = () => {
                if (currentPage < totalPages) {
                    currentMismatchPage = currentPage + 1;
                    displayMismatchesList(data, currentMismatchPage);
                }
            };
            controlsContainer.appendChild(nextBtn);

            // Page info
            const pageInfo = document.createElement('div');
            pageInfo.style.padding = '8px 12px';
            pageInfo.style.color = 'var(--text-secondary)';
            pageInfo.style.fontSize = '0.85rem';
            pageInfo.textContent = `Página ${currentPage} de ${totalPages} (${data.mismatchesList.length} actas con diferencias)`;
            controlsContainer.appendChild(pageInfo);
        }

        // Load mismatches data when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            // Wait a bit to ensure other data is loaded first
            setTimeout(() => {
                loadMismatchesData();
            }, 1000);
        });

    </script>
</body>
</html>
